<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stokvel Pro</title>
    <!-- Add Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Add Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1e3a8a;
            --primary-light: #3b82f6;
            --accent: #f59e0b;
            --accent-light: #fbbf24;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --neutral: #f8fafc;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --shadow: 0 8px 30px rgba(0,0,0,0.12);
            --shadow-lg: 0 15px 40px rgba(0,0,0,0.15);
            --gradient-primary: linear-gradient(135deg, #1e3a8a, #3b82f6);
            --gradient-accent: linear-gradient(135deg, #f59e0b, #fbbf24);
            --gradient-success: linear-gradient(135deg, #10b981, #34d399);
            --gradient-danger: linear-gradient(135deg, #ef4444, #f87171);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--neutral);
            color: var(--text-dark);
            padding-top: 80px;
            padding-bottom: 80px;
        }

        .app-container {
            min-height: 100vh;
        }

        /* Enhanced Navigation */
        .navbar {
            background: var(--gradient-primary);
            box-shadow: var(--shadow);
            padding: 0.75rem 0;
        }

        .navbar-brand {
            padding: 0;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .logo-text {
            font-weight: 700;
            font-size: 1.25rem;
            color: white;
            line-height: 1;
        }

        .logo-subtitle {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1;
        }

        .navbar-nav .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            margin: 0 0.25rem;
            transition: all 0.3s ease;
        }

        .navbar-nav .nav-link:hover,
        .navbar-nav .nav-link.active {
            background: rgba(255, 255, 255, 0.15);
            color: white !important;
        }

        .notification-badge {
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 4px;
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Profile Hero Section */
        .profile-hero {
            background: var(--gradient-primary);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        /* Stats Cards */
        .stats-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 100%;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stats-card.savings {
            border-left-color: var(--success);
        }

        .stats-card.members {
            border-left-color: var(--primary-light);
        }

        .stats-card.groups {
            border-left-color: var(--warning);
        }

        .stats-card.events {
            border-left-color: var(--accent);
        }

        .stats-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .stats-icon.savings {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .stats-icon.members {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary-light);
        }

        .stats-icon.groups {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .stats-icon.events {
            background: rgba(245, 158, 11, 0.1);
            color: var(--accent);
        }

        /* Cards */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }

        .card-header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 1.5rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Activity Timeline */
        .activity-item {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.3s ease;
        }

        .activity-item:hover {
            background-color: var(--neutral);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-actions {
            display: flex;
            gap: 0.5rem;
        }

        .like-btn:hover {
            background-color: var(--success);
            border-color: var(--success);
            color: white;
        }

        .comment-btn:hover {
            background-color: var(--primary-light);
            border-color: var(--primary-light);
            color: white;
        }

        .share-btn:hover {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .comment-form {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        .comment-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        /* Quick Actions */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .action-card {
            background: var(--neutral);
            padding: 1.5rem 1rem;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .action-card:hover {
            background: white;
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .action-icon {
            width: 50px;
            height: 50px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin: 0 auto 1rem;
        }

        /* Progress Bars */
        .progress-container {
            background: #e2e8f0;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Communication Section */
        .communication-section {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .chat-container {
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            background: white;
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: var(--neutral);
        }

        .message {
            display: flex;
            margin-bottom: 1.5rem;
            gap: 1rem;
        }

        .message.own {
            flex-direction: row-reverse;
        }

        .message.own .message-content {
            background: var(--primary);
            color: white;
        }

        .message.own .message-content .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }

        .message-content {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            max-width: 70%;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .message-sender {
            font-weight: 600;
            flex: 1;
        }

        .message-time {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .message-text {
            line-height: 1.5;
        }

        .reactions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .reaction {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            background: var(--neutral);
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reaction:hover {
            background: #e2e8f0;
        }

        .reaction.active {
            background: var(--primary);
            color: white;
        }

        .message-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .message-action {
            background: none;
            border: none;
            color: inherit;
            font-size: 0.8rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .message-action:hover {
            opacity: 1;
        }

        .file-attachment {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--neutral);
            border-radius: 8px;
            margin-top: 0.5rem;
        }

        .file-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .file-size {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .chat-input-container {
            padding: 1.5rem;
            border-top: 1px solid #e2e8f0;
            background: white;
        }

        .chat-input-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 1rem;
            background: var(--neutral);
            border-radius: 12px;
            padding: 1rem;
        }

        .chat-input {
            flex: 1;
            border: none;
            background: none;
            resize: none;
            outline: none;
            font-family: inherit;
            line-height: 1.5;
            max-height: 120px;
        }

        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }

        .chat-action-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-light);
        }

        .chat-action-btn:hover {
            background: var(--primary);
            color: white;
        }

        .send-btn {
            background: var(--primary);
            color: white;
        }

        .send-btn:hover {
            background: var(--primary-light);
        }

        /* Social Tabs */
        .social-tabs .nav-tabs {
            border-bottom: 2px solid #e2e8f0;
        }

        .social-tabs .nav-link {
            border: none;
            color: var(--text-light);
            font-weight: 500;
            padding: 1rem 1.5rem;
            border-radius: 0;
        }

        .social-tabs .nav-link.active {
            color: var(--primary);
            background: none;
            border-bottom: 2px solid var(--primary);
        }

        /* Announcements */
        .announcement-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary);
        }

        .announcement-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .announcement-badge {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .announcement-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Polls */
        .poll-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .poll-option {
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .poll-option:hover {
            border-color: var(--primary);
            background: rgba(30, 58, 138, 0.05);
        }

        .poll-option.selected {
            border-color: var(--primary);
            background: rgba(30, 58, 138, 0.1);
        }

        .poll-stats {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .poll-percentage {
            font-weight: 600;
            color: var(--primary);
            min-width: 40px;
        }

        .poll-bar {
            flex: 1;
            background: #e2e8f0;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
        }

        .poll-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Events Feed */
        .event-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.3s ease;
        }

        .event-item:hover {
            background-color: var(--neutral);
        }

        .event-item:last-child {
            border-bottom: none;
        }

        .event-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            flex-shrink: 0;
        }

        .event-content {
            flex: 1;
        }

        .event-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Online Members */
        .online-members {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }

        .online-member {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .online-member:last-child {
            border-bottom: none;
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            margin-left: auto;
        }

        /* Profile Section */
        .profile-combined-container {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .profile-hero {
            background: var(--gradient-primary);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            position: relative;
        }

        .profile-avatar-container {
            position: relative;
            display: inline-block;
            margin-bottom: 1.5rem;
        }

        .profile-avatar {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            object-fit: cover;
        }

        .avatar-upload {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .avatar-upload:hover {
            background: var(--accent-light);
            transform: scale(1.1);
        }

        .welcome-name {
            color: var(--accent-light);
        }

        .title {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        .profile-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-umbrella {
            background: var(--accent);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-umbrella:hover {
            background: var(--accent-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .profile-content {
            padding: 2rem;
        }

        .profile-section {
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .section-title {
            color: var(--primary);
            margin: 0;
        }

        .equal-height-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .equal-height-card {
            background: var(--neutral);
            border-radius: 10px;
            overflow: hidden;
        }

        .equal-height-content {
            padding: 1.5rem;
        }

        .personal-info-item,
        .security-preference-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .personal-info-item:last-child,
        .security-preference-item:last-child {
            border-bottom: none;
        }

        .personal-info-label,
        .security-preference-label {
            font-weight: 600;
            color: var(--text-dark);
            flex: 1;
        }

        .personal-info-value,
        .security-preference-value {
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .edit-form {
            background: var(--neutral);
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1rem;
        }

        .info-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* Notifications */
        .list-group-item {
            border: none;
            border-bottom: 1px solid #e2e8f0;
            padding: 1.25rem;
            transition: background-color 0.3s ease;
        }

        .list-group-item:hover {
            background-color: var(--neutral);
        }

        .list-group-item:last-child {
            border-bottom: none;
        }

        /* Footer */
        .legal-footer {
            background: #1e293b;
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .legal-footer .logo-icon {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Bottom Navigation (Mobile) */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 0.75rem 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            border-top: 1px solid #e2e8f0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-light);
            font-size: 0.75rem;
            transition: all 0.3s ease;
            padding: 0.5rem;
            border-radius: 8px;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item:hover {
            color: var(--primary);
            background: rgba(30, 58, 138, 0.05);
        }

        .nav-icon {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        /* Utility Classes */
        .text-orange {
            color: var(--accent) !important;
        }

        .bg-orange {
            background-color: var(--accent) !important;
        }

        .opacity-90 {
            opacity: 0.9;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 70px;
            }
            
            .main-content {
                padding: 1rem 0;
            }
            
            .profile-hero {
                padding: 1.5rem;
                text-align: center;
            }
            
            .quick-actions-grid {
                grid-template-columns: 1fr;
            }
            
            .equal-height-grid {
                grid-template-columns: 1fr;
            }
            
            .chat-messages {
                padding: 1rem;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .profile-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .navbar-collapse {
                background: #1e3a8a;
                margin-top: 1rem;
                border-radius: 8px;
                padding: 1rem;
            }
        }

        @media (max-width: 576px) {
            .stats-card {
                text-align: center;
            }
            
            .activity-actions {
                flex-wrap: wrap;
            }
            
            .event-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .online-member {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }
            
            .online-indicator {
                margin-left: 0;
            }
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Add to existing CSS - better mobile touches */
        @media (max-width: 768px) {
            .action-card {
                padding: 1rem 0.5rem;
            }
            
            .chat-action-btn {
                width: 44px;
                height: 44px; /* Better touch targets */
            }
            
            .nav-item {
                padding: 0.75rem;
                min-width: 60px; /* Larger touch area */
            }
        }

        /* Add simple loading states */
        .btn-loading {
            position: relative;
            color: transparent;
        }

        .btn-loading:after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin: -8px 0 0 -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-right-color: transparent;
            animation: spin 1s linear infinite;
        }

        .offline {
            opacity: 0.7;
        }

        .offline::before {
            content: 'âš¡ Offline';
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: #ffc107;
            color: #000;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 10000;
        }

        .goal-item {
            padding: 1rem;
            border-radius: 8px;
            background: white;
            box-shadow: var(--shadow);
            margin-bottom: 1rem;
        }

        .mark-paid-btn {
            transition: all 0.3s ease;
        }

        .mark-paid-btn:hover {
            transform: scale(1.05);
        }

        /* Smart Contributions Styles */
        .smart-contributions-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .suggestion-card {
            background: var(--neutral);
            border-radius: 10px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .suggestion-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .suggestion-card.warning {
            border-left-color: var(--warning);
        }

        .suggestion-card.success {
            border-left-color: var(--success);
        }

        .suggestion-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }

        .suggestion-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .suggestion-card.warning .suggestion-icon {
            background: var(--warning);
        }

        .suggestion-card.success .suggestion-icon {
            background: var(--success);
        }

        .contribution-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: var(--neutral);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            display: block;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-light);
            display: block;
        }

        .quick-action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        /* Enhanced Security Styles */
        .security-dashboard {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .security-status-card {
            background: var(--neutral);
            border-radius: 10px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--success);
        }

        .security-status-card.warning {
            border-left-color: var(--warning);
        }

        .security-status-card.critical {
            border-left-color: var(--danger);
        }

        .security-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .security-metric:last-child {
            border-bottom: none;
        }

        .security-score {
            text-align: center;
            padding: 1.5rem;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: conic-gradient(var(--success) 0% 75%, #e2e8f0 75% 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            position: relative;
        }

        .score-circle::before {
            content: '';
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            position: absolute;
        }

        .score-circle .score {
            position: relative;
            z-index: 1;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-dark);
        }

        .security-feature {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--neutral);
            border-radius: 8px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .security-feature:hover {
            background: #f1f5f9;
            transform: translateX(5px);
        }

        .feature-status {
            margin-left: auto;
        }

        .activity-log {
            max-height: 300px;
            overflow-y: auto;
        }

        .security-activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .security-activity-item:last-child {
            border-bottom: none;
        }

        .security-activity-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .activity-details {
            flex: 1;
        }

        .activity-meta {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .session-timeout-warning {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
        }

        .encryption-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--success);
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .encryption-status.off {
            background: var(--danger);
        }

        .encryption-badge {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .encryption-settings {
            background: var(--neutral);
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .encryption-key-display {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            margin: 1rem 0;
        }

        .key-management {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1rem;
            align-items: center;
        }

        .encrypted-message-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--success);
            margin-top: 0.5rem;
        }

        .encryption-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .security-level-indicator {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .security-level-bar {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .security-level-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .security-level-fill.strong {
            background: var(--success);
            width: 90%;
        }

        .security-level-fill.medium {
            background: var(--warning);
            width: 60%;
        }

        .security-level-fill.weak {
            background: var(--danger);
            width: 30%;
        }

        .export-keys-section {
            border-top: 1px solid #e2e8f0;
            padding-top: 1.5rem;
            margin-top: 1.5rem;
        }

        .encryption-help {
            background: rgba(59, 130, 246, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .help-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .help-item:last-child {
            margin-bottom: 0;
        }

        .help-icon {
            color: var(--primary);
            font-size: 0.9rem;
            margin-top: 0.1rem;
        }

        /* Payment Scheduling Styles */
        .scheduled-payment-item {
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
            background: white;
        }

        .scheduled-payment-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
            transform: translateY(-1px);
        }

        .payment-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Achievements Grid */
        .achievements-grid {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .achievement-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 10px;
            background: var(--neutral);
            transition: all 0.3s ease;
        }

        .achievement-item.earned {
            border-left: 4px solid var(--success);
        }

        .achievement-item.locked {
            opacity: 0.6;
            border-left: 4px solid var(--text-light);
        }

        .achievement-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .achievement-icon {
            font-size: 1.5rem;
            width: 40px;
            text-align: center;
        }

        .achievement-info {
            flex: 1;
        }

        .achievement-info strong {
            display: block;
            margin-bottom: 0.25rem;
        }

        .achievement-info small {
            color: var(--text-light);
        }
  .user-signed-in .auth-only { display: block; }
.user-signed-out .auth-only { display: none; }

.user-signed-out .user-only { display: none; }
.user-signed-in .user-only { display: block; }

/* Hide user content when signed out */
.user-signed-out .main-content { display: none; }
.user-signed-out .bottom-nav { display: none; }
.user-signed-out .legal-footer { display: none; }

/* Show auth content when signed out */
.user-signed-out .auth-content { display: block; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Enhanced Navigation - Fixed Top -->
        <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <div class="logo-container">
                        <div class="logo-icon">
                            <i class="fas fa-piggy-bank"></i>
                        </div>
                        <div>
                            <div class="logo-text">Stokvel Pro</div>
                            <div class="logo-subtitle">Level up your stokvel game</div>
                        </div>
                    </div>
                </a>
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-tab="home-tab">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="groups-tab">Groups</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="notifications-tab">
                                Notifications
                                <span class="notification-badge">3</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-tab="profile-tab">Profile</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content - Adjusted for Fixed Nav -->
        <div class="container main-content">
            <!-- Home Tab Content -->
            <div id="home-tab" class="tab-content active">
                <!-- Profile Hero Section -->
                <div class="profile-hero">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="display-6 fw-bold mb-2">Welcome back, Lerato! ðŸ‘‹</h1>
                            <p class="mb-0 opacity-90">Track your savings groups, monitor contributions, and manage your stokvel activities all in one place</p>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <div class="d-flex justify-content-md-end align-items-center gap-3">
                                <div class="text-center">
                                    <div class="fs-2 fw-bold">4.8</div>
                                    <small class="opacity-90">Trust Score</small>
                                </div>
                                <div class="vr bg-white opacity-50" style="height: 40px;"></div>
                                <div class="text-center">
                                    <div class="fs-2 fw-bold">12</div>
                                    <small class="opacity-90">Months Active</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Overview -->
                <div class="row g-4 mb-4">
                    <div class="col-xl-3 col-md-6">
                        <div class="stats-card savings">
                            <div class="stats-icon savings">
                                <i class="fas fa-piggy-bank"></i>
                            </div>
                            <h3 class="text-success">R45,820</h3>
                            <p class="text-muted">Total Savings</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-success">+12%</span>
                                <small class="text-muted">This month</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="stats-card members">
                            <div class="stats-icon members">
                                <i class="fas fa-users"></i>
                            </div>
                            <h3 class="text-primary">156</h3>
                            <p class="text-muted">Active Members</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-primary">+8</span>
                                <small class="text-muted">This week</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="stats-card groups">
                            <div class="stats-icon groups">
                                <i class="fas fa-layer-group"></i>
                            </div>
                            <h3 class="text-warning">9</h3>
                            <p class="text-muted">Active Groups</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-warning">+1</span>
                                <small class="text-muted">New group</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="stats-card events">
                            <div class="stats-icon events">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <h3 class="text-orange">5</h3>
                            <p class="text-muted">Upcoming Events</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-orange">Tomorrow</span>
                                <small class="text-muted">Next: Meeting</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-4">
                    <!-- Left Column -->
                    <div class="col-lg-8">
                        <!-- Activity Timeline -->
                        <div class="card">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-stream me-2 text-primary"></i>Recent Activity</h5>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-filter me-1"></i>Filter
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#">All Activities</a></li>
                                        <li><a class="dropdown-item" href="#">Contributions</a></li>
                                        <li><a class="dropdown-item" href="#">Memberships</a></li>
                                        <li><a class="dropdown-item" href="#">Meetings</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="activity-timeline">
                                    <div class="activity-item contribution">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <div class="d-flex align-items-center">
                                                <div class="bg-success rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                                                    <i class="fas fa-money-bill-wave text-white"></i>
                                                </div>
                                                <div>
                                                    <p class="mb-1 fw-semibold">You contributed R2,500 to Investment Club</p>
                                                    <small class="text-muted"><i class="fas fa-clock me-1"></i>2 hours ago â€¢ Monthly contribution</small>
                                                </div>
                                            </div>
                                            <span class="badge bg-success">Completed</span>
                                        </div>
                                        <div class="activity-actions mt-3">
                                            <button class="btn btn-sm btn-outline-primary me-2 like-btn">
                                                <i class="far fa-thumbs-up me-1"></i> Like
                                            </button>
                                            <button class="btn btn-sm btn-outline-primary me-2 comment-btn">
                                                <i class="far fa-comment me-1"></i> Comment
                                            </button>
                                            <button class="btn btn-sm btn-outline-primary share-btn">
                                                <i class="fas fa-share me-1"></i> Share
                                            </button>
                                        </div>
                                        <!-- Comment Form (Hidden by default) -->
                                        <div class="comment-form" style="display: none;">
                                            <textarea class="form-control" placeholder="Write your comment here..."></textarea>
                                            <div class="comment-actions">
                                                <button type="button" class="btn btn-sm btn-outline-secondary cancel-comment">Cancel</button>
                                                <button type="button" class="btn btn-sm btn-primary post-comment">Post Comment</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="activity-item membership">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <div class="d-flex align-items-center">
                                                <div class="bg-warning rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                                                    <i class="fas fa-user-plus text-white"></i>
                                                </div>
                                                <div>
                                                    <p class="mb-1 fw-semibold">David Mokoena joined Family Savings Group</p>
                                                    <small class="text-muted"><i class="fas fa-clock me-1"></i>5 hours ago â€¢ New member</small>
                                                </div>
                                            </div>
                                            <span class="badge bg-warning">Membership</span>
                                        </div>
                                        <div class="activity-actions mt-3">
                                            <button class="btn btn-sm btn-outline-primary me-2 like-btn">
                                                <i class="far fa-thumbs-up me-1"></i> Like
                                            </button>
                                            <button class="btn btn-sm btn-outline-primary me-2 comment-btn">
                                                <i class="far fa-comment me-1"></i> Comment
                                            </button>
                                            <button class="btn btn-sm btn-outline-primary share-btn">
                                                <i class="fas fa-share me-1"></i> Share
                                            </button>
                                        </div>
                                        <!-- Comment Form (Hidden by default) -->
                                        <div class="comment-form" style="display: none;">
                                            <textarea class="form-control" placeholder="Write your comment here..."></textarea>
                                            <div class="comment-actions">
                                                <button type="button" class="btn btn-sm btn-outline-secondary cancel-comment">Cancel</button>
                                                <button type="button" class="btn btn-sm btn-primary post-comment">Post Comment</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="activity-item meeting">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <div class="d-flex align-items-center">
                                                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                                                    <i class="fas fa-calendar-alt text-white"></i>
                                                </div>
                                                <div>
                                                    <p class="mb-1 fw-semibold">Monthly meeting scheduled for Investment Club</p>
                                                    <small class="text-muted"><i class="fas fa-clock me-1"></i>1 day ago â€¢ March 25, 2024</small>
                                                </div>
                                            </div>
                                            <span class="badge bg-primary">Upcoming</span>
                                        </div>
                                        <div class="activity-actions mt-3">
                                            <button class="btn btn-sm btn-outline-primary me-2 like-btn">
                                                <i class="far fa-thumbs-up me-1"></i> Like
                                            </button>
                                            <button class="btn btn-sm btn-outline-primary me-2 comment-btn">
                                                <i class="far fa-comment me-1"></i> Comment
                                            </button>
                                            <button class="btn btn-sm btn-outline-primary share-btn">
                                                <i class="fas fa-share me-1"></i> Share
                                            </button>
                                        </div>
                                        <!-- Comment Form (Hidden by default) -->
                                        <div class="comment-form" style="display: none;">
                                            <textarea class="form-control" placeholder="Write your comment here..."></textarea>
                                            <div class="comment-actions">
                                                <button type="button" class="btn btn-sm btn-outline-secondary cancel-comment">Cancel</button>
                                                <button type="button" class="btn btn-sm btn-primary post-comment">Post Comment</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="col-lg-4">
                        <!-- Quick Actions -->
                        <div class="card">
                            <div class="card-header py-3">
                                <h5 class="mb-0"><i class="fas fa-bolt me-2 text-warning"></i>Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="quick-actions-grid">
                                    <div class="action-card" data-action="contribution">
                                        <div class="action-icon">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </div>
                                        <h6 class="mb-1">Add Contribution</h6>
                                        <small class="text-muted">Make payment</small>
                                    </div>
                                    <div class="action-card" data-action="group">
                                        <div class="action-icon">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <h6 class="mb-1">Create Group</h6>
                                        <small class="text-muted">New stokvel</small>
                                    </div>
                                    <div class="action-card" data-action="meeting">
                                        <div class="action-icon">
                                            <i class="fas fa-calendar-plus"></i>
                                        </div>
                                        <h6 class="mb-1">Schedule Meeting</h6>
                                        <small class="text-muted">Plan gathering</small>
                                    </div>
                                    <div class="action-card" data-action="report">
                                        <div class="action-icon">
                                            <i class="fas fa-chart-pie"></i>
                                        </div>
                                        <h6 class="mb-1">Generate Report</h6>
                                        <small class="text-muted">Financial summary</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Group Performance -->
                        <div class="card mt-4">
                            <div class="card-header py-3">
                                <h5 class="mb-0"><i class="fas fa-trophy me-2 text-warning"></i>Group Performance</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span>Investment Club</span>
                                        <span class="fw-semibold">95%</span>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-fill" style="width: 95%;"></div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span>Family Savings</span>
                                        <span class="fw-semibold">78%</span>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-fill" style="width: 78%;"></div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span>Emergency Fund</span>
                                        <span class="fw-semibold">65%</span>
                                    </div>
                                    <div class="progress-container">
                                        <div class="progress-fill" style="width: 65%;"></div>
                                    </div>
                                </div>
                                <div class="text-center mt-3">
                                    <button class="btn btn-outline-primary btn-sm" id="view-analytics-btn">
                                        <i class="fas fa-chart-line me-1"></i>View Detailed Analytics
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Smart Contribution Suggestions -->
                        <div class="card">
                            <div class="card-header py-3">
                                <h5 class="mb-0"><i class="fas fa-brain me-2 text-primary"></i>Smart Contribution Suggestions</h5>
                            </div>
                            <div class="card-body">
                                <div id="smart-contributions-container">
                                    <!-- Dynamic content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Groups Tab -->
            <div id="groups-tab" class="tab-content">
                <div class="row">
                    <!-- Left Column - Chat & Main Features -->
                    <div class="col-lg-8">
                        <!-- Group Chat -->
                        <div class="communication-section">
                            <div class="chat-container">
                                <div class="chat-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5 class="mb-1">
                                                <i class="fas fa-comments me-2"></i>Group Chat
                                                <span class="encryption-badge ms-2" id="encryption-status-badge">
                                                    <i class="fas fa-lock me-1"></i>Encrypted
                                                </span>
                                            </h5>
                                            <small class="opacity-90">Real-time communication with all members</small>
                                        </div>
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="badge bg-success">
                                                <i class="fas fa-circle me-1"></i>12 Online
                                            </span>
                                            <div class="dropdown">
                                                <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                                    <i class="fas fa-cog"></i>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="#" id="encryption-settings-btn">
                                                        <i class="fas fa-lock me-2"></i>Encryption Settings
                                                    </a></li>
                                                    <li><a class="dropdown-item" href="#" id="export-keys-btn">
                                                        <i class="fas fa-key me-2"></i>Export Keys
                                                    </a></li>
                                                    <li><hr class="dropdown-divider"></li>
                                                    <li><a class="dropdown-item" href="#">
                                                        <i class="fas fa-users me-2"></i>Manage Members
                                                    </a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="chat-messages" id="chatMessages">
                                    <!-- Message 1 -->
                                    <div class="message">
                                        <div class="message-avatar bg-primary">SJ</div>
                                        <div class="message-content">
                                            <div class="message-header">
                                                <span class="message-sender">Sarah Johnson</span>
                                                <span class="message-time">2:30 PM</span>
                                            </div>
                                            <div class="message-text">
                                                Hi everyone! Just submitted my monthly contribution. Looking forward to our meeting next week!
                                            </div>
                                            <div class="reactions">
                                                <div class="reaction">
                                                    <i class="fas fa-thumbs-up"></i>
                                                    <span>3</span>
                                                </div>
                                                <div class="reaction">
                                                    <i class="fas fa-heart"></i>
                                                    <span>1</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Message 2 -->
                                    <div class="message own">
                                        <div class="message-avatar bg-success">YM</div>
                                        <div class="message-content">
                                            <div class="message-header">
                                                <span class="message-sender">You</span>
                                                <span class="message-time">2:32 PM</span>
                                            </div>
                                            <div class="message-text">
                                                Thanks Sarah! I've also made my payment. Does anyone have agenda items for the meeting?
                                            </div>
                                            <div class="message-actions">
                                                <button class="message-action">
                                                    <i class="far fa-thumbs-up"></i> Like
                                                </button>
                                                <button class="message-action">
                                                    <i class="far fa-comment"></i> Reply
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Message 3 -->
                                    <div class="message">
                                        <div class="message-avatar bg-warning">MC</div>
                                        <div class="message-content">
                                            <div class="message-header">
                                                <span class="message-sender">Mike Chen</span>
                                                <span class="message-time">2:35 PM</span>
                                            </div>
                                            <div class="message-text">
                                                I'd like to discuss our investment in the new tech ETF. The returns have been great this quarter!
                                            </div>
                                            <div class="file-attachment">
                                                <div class="file-icon">
                                                    <i class="fas fa-chart-line"></i>
                                                </div>
                                                <div class="file-info">
                                                    <div class="file-name">Q1 Investment Report.pdf</div>
                                                    <div class="file-size">2.4 MB</div>
                                                </div>
                                                <button class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-download"></i>
                                                </button>
                                            </div>
                                            <div class="reactions">
                                                <div class="reaction active">
                                                    <i class="fas fa-thumbs-up"></i>
                                                    <span>5</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="chat-input-container">
                                    <div class="chat-input-wrapper">
                                        <textarea class="chat-input" placeholder="Type your message here..." rows="1"></textarea>
                                        <div class="chat-actions">
                                            <button class="chat-action-btn" title="Attach file">
                                                <i class="fas fa-paperclip"></i>
                                            </button>
                                            <button class="chat-action-btn" title="Add emoji">
                                                <i class="far fa-smile"></i>
                                            </button>
                                            <button class="chat-action-btn send-btn" title="Send message">
                                                <i class="fas fa-paper-plane"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Social Tabs for Additional Features -->
                        <div class="social-tabs mb-4">
                            <ul class="nav nav-tabs" id="socialTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="announcements-tab" data-bs-toggle="tab" data-bs-target="#announcements" type="button" role="tab">
                                        <i class="fas fa-bullhorn me-2"></i>Announcements
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="polls-tab" data-bs-toggle="tab" data-bs-target="#polls" type="button" role="tab">
                                        <i class="fas fa-poll me-2"></i>Polls
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events" type="button" role="tab">
                                        <i class="fas fa-calendar-day me-2"></i>Events
                                    </button>
                                </li>
                            </ul>
                        </div>

                        <div class="tab-content" id="socialTabContent">
                            <!-- Announcements Tab -->
                            <div class="tab-pane fade show active" id="announcements" role="tabpanel">
                                <div class="announcements-container">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5>Group Announcements</h5>
                                        <button class="btn btn-umbrella btn-sm">
                                            <i class="fas fa-plus me-1"></i>New Announcement
                                        </button>
                                    </div>

                                    <div class="announcement-card">
                                        <div class="announcement-header">
                                            <span class="announcement-badge">Important</span>
                                            <div class="announcement-actions">
                                                <button class="btn btn-sm btn-outline-secondary">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <h6>Monthly Meeting Agenda Posted</h6>
                                        <p class="text-muted mb-2">The agenda for our upcoming monthly meeting has been posted. Please review and come prepared with your contributions.</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">Posted by Sarah Johnson â€¢ 2 hours ago</small>
                                            <div class="reactions">
                                                <div class="reaction">
                                                    <i class="fas fa-eye"></i>
                                                    <span>42</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="announcement-card">
                                        <div class="announcement-header">
                                            <span class="announcement-badge">Update</span>
                                            <div class="announcement-actions">
                                                <button class="btn btn-sm btn-outline-secondary">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <h6>New Investment Opportunity</h6>
                                        <p class="text-muted mb-2">We've identified a promising new investment in renewable energy. Discussion scheduled for next meeting.</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">Posted by Mike Chen â€¢ 1 day ago</small>
                                            <div class="reactions">
                                                <div class="reaction">
                                                    <i class="fas fa-eye"></i>
                                                    <span>38</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Polls Tab -->
                            <div class="tab-pane fade" id="polls" role="tabpanel">
                                <div class="poll-container">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5>Active Polls</h5>
                                        <button class="btn btn-umbrella btn-sm">
                                            <i class="fas fa-plus me-1"></i>Create Poll
                                        </button>
                                    </div>

                                    <div class="poll-card">
                                        <h6>Preferred Meeting Time</h6>
                                        <p class="text-muted mb-3">What time works best for our monthly meetings?</p>
                                        
                                        <div class="poll-option selected">
                                            <span>Weekday Evenings (6-8 PM)</span>
                                            <div class="poll-stats">
                                                <span class="poll-percentage">65%</span>
                                                <div class="poll-bar">
                                                    <div class="poll-fill" style="width: 65%"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="poll-option">
                                            <span>Saturday Mornings (9-11 AM)</span>
                                            <div class="poll-stats">
                                                <span class="poll-percentage">25%</span>
                                                <div class="poll-bar">
                                                    <div class="poll-fill" style="width: 25%"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="poll-option">
                                            <span>Sunday Afternoons (2-4 PM)</span>
                                            <div class="poll-stats">
                                                <span class="poll-percentage">10%</span>
                                                <div class="poll-bar">
                                                    <div class="poll-fill" style="width: 10%"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mt-3 text-center">
                                            <small class="text-muted">28 votes â€¢ Ends in 3 days</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Events Tab -->
                            <div class="tab-pane fade" id="events" role="tabpanel">
                                <div class="events-feed">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5>Recent Activity</h5>
                                        <button class="btn btn-outline-primary btn-sm">
                                            <i class="fas fa-filter me-1"></i>Filter
                                        </button>
                                    </div>

                                    <div class="event-item">
                                        <div class="event-icon bg-success">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </div>
                                        <div class="event-content">
                                            <h6 class="mb-1">David Mokoena made a contribution</h6>
                                            <p class="text-muted mb-1">Submitted monthly payment of R2,500</p>
                                            <div class="event-meta">
                                                <span><i class="fas fa-clock me-1"></i>30 minutes ago</span>
                                                <span><i class="fas fa-comment me-1"></i>2 comments</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="event-item">
                                        <div class="event-icon bg-primary">
                                            <i class="fas fa-user-plus"></i>
                                        </div>
                                        <div class="event-content">
                                            <h6 class="mb-1">New member joined</h6>
                                            <p class="text-muted mb-1">Linda Nkosi has been added to the group</p>
                                            <div class="event-meta">
                                                <span><i class="fas fa-clock me-1"></i>2 hours ago</span>
                                                <span><i class="fas fa-thumbs-up me-1"></i>8 likes</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="event-item">
                                        <div class="event-icon bg-warning">
                                            <i class="fas fa-file-alt"></i>
                                        </div>
                                        <div class="event-content">
                                            <h6 class="mb-1">Meeting minutes updated</h6>
                                            <p class="text-muted mb-1">February meeting minutes have been posted</p>
                                            <div class="event-meta">
                                                <span><i class="fas fa-clock me-1"></i>1 day ago</span>
                                                <span><i class="fas fa-download me-1"></i>12 downloads</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Sidebar Features -->
                    <div class="col-lg-4">
                        <!-- Online Members -->
                        <div class="online-members">
                            <h5 class="mb-3">Online Now</h5>
                            <div class="online-member">
                                <div class="message-avatar bg-primary">SJ</div>
                                <div>
                                    <div class="fw-semibold">Sarah Johnson</div>
                                    <small class="text-muted">Group Admin</small>
                                </div>
                                <div class="online-indicator"></div>
                            </div>
                            <div class="online-member">
                                <div class="message-avatar bg-success">MC</div>
                                <div>
                                    <div class="fw-semibold">Mike Chen</div>
                                    <small class="text-muted">Treasurer</small>
                                </div>
                                <div class="online-indicator"></div>
                            </div>
                            <div class="online-member">
                                <div class="message-avatar bg-warning">DM</div>
                                <div>
                                    <div class="fw-semibold">David Mokoena</div>
                                    <small class="text-muted">Member</small>
                                </div>
                                <div class="online-indicator"></div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="online-members">
                            <h5 class="mb-3">Quick Actions</h5>
                            <button class="btn btn-outline-primary w-100 mb-2">
                                <i class="fas fa-video me-2"></i>Start Video Call
                            </button>
                            <button class="btn btn-outline-primary w-100 mb-2">
                                <i class="fas fa-phone me-2"></i>Voice Chat
                            </button>
                            <button class="btn btn-outline-primary w-100 mb-2">
                                <i class="fas fa-share-alt me-2"></i>Share Screen
                            </button>
                            <button class="btn btn-outline-primary w-100">
                                <i class="fas fa-history me-2"></i>Chat History
                            </button>
                        </div>

                        <!-- Group Resources -->
                        <div class="online-members">
                            <h5 class="mb-3">Resources</h5>
                            <div class="file-attachment mb-2">
                                <div class="file-icon">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Group Rules.pdf</div>
                                    <div class="file-size">1.2 MB</div>
                                </div>
                            </div>
                            <div class="file-attachment mb-2">
                                <div class="file-icon">
                                    <i class="fas fa-file-excel"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Contribution Template.xlsx</div>
                                    <div class="file-size">0.8 MB</div>
                                </div>
                            </div>
                            <div class="file-attachment">
                                <div class="file-icon">
                                    <i class="fas fa-file-word"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Meeting Agenda.docx</div>
                                    <div class="file-size">0.5 MB</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications Tab -->
            <div id="notifications-tab" class="tab-content">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-0"><i class="fas fa-bell me-2"></i>Notifications & Alerts</h4>
                            <small class="text-muted">Stay updated on your stokvel activities</small>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" id="mark-all-read">
                                <i class="fas fa-check-double me-1"></i>Mark All Read
                            </button>
                            <button class="btn btn-sm btn-outline-secondary">
                                <i class="fas fa-cog me-1"></i>Settings
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="list-group" id="notifications-list">
                            <a href="#" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">
                                        <i class="fas fa-money-bill-wave text-success me-2"></i>
                                        Contribution Received
                                    </h6>
                                    <small class="text-muted">2 hours ago</small>
                                </div>
                                <p class="mb-1">Sarah Johnson made her monthly contribution of R1,500 to Investment Club</p>
                                <small class="text-muted"><i class="fas fa-circle text-success me-1"></i>Unread</small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profile-tab" class="tab-content">
                <div class="profile-container">
                    <!-- Combined Profile Container -->
                    <div class="profile-combined-container">
                        <!-- Avatar Hero Section -->
                        <div class="profile-hero">
                            <div class="profile-avatar-container">
                                <img src="https://ui-avatars.com/api/?name=Thabo+Mbeki&background=1a472a&color=FFFFFF&size=140" class="profile-avatar" id="profile-avatar" alt="Thabo Mbeki">
                                <button class="avatar-upload" id="avatar-upload-btn">
                                    <i class="fas fa-camera"></i>
                                </button>
                                <input type="file" id="avatar-upload-input" accept="image/*" style="display: none;">
                            </div>
                            
                            <h1>Welcome, <span class="welcome-name" id="welcome-name">Thabo Mbeki</span>!</h1>
                            <p class="title">Stokvel Administrator & Group Coordinator</p>
                            
                            <div class="profile-actions">
                                <button class="btn btn-umbrella" id="edit-profile-btn">
                                    <i class="fas fa-edit me-2"></i>Edit Profile
                                </button>
                                <button class="btn btn-outline-light" id="change-password-btn">
                                    <i class="fas fa-key me-2"></i>Change Password
                                </button>
                            </div>
                        </div>

                        <!-- Profile Content Sections -->
                        <div class="profile-content">
                            <!-- Personal Information Section -->
                            <div class="profile-section compact-section personal-info-section">
                                <div class="section-header">
                                    <i class="fas fa-user-circle fa-lg"></i>
                                    <h3 class="section-title">Personal Information</h3>
                                </div>
                                
                                <div class="equal-height-grid" id="personal-info-view">
                                    <div class="equal-height-card">
                                        <div class="equal-height-content">
                                            <div class="personal-info-item">
                                                <div class="personal-info-label">Full Name</div>
                                                <div class="personal-info-value" id="view-full-name">Thabo Mbeki</div>
                                            </div>
                                            <div class="personal-info-item">
                                                <div class="personal-info-label">Email Address</div>
                                                <div class="personal-info-value" id="view-email">thabo.mbeki@stokvelpro.co.za</div>
                                            </div>
                                            <div class="personal-info-item">
                                                <div class="personal-info-label">Phone Number</div>
                                                <div class="personal-info-value" id="view-phone">+27 11 234 5678</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="equal-height-card">
                                        <div class="equal-height-content">
                                            <div class="personal-info-item">
                                                <div class="personal-info-label">Member Since</div>
                                                <div class="personal-info-value" id="view-member-since">January 15, 2023</div>
                                            </div>
                                            <div class="personal-info-item">
                                                <div class="personal-info-label">Account Status</div>
                                                <div class="personal-info-value"><span class="badge bg-primary">Verified</span></div>
                                            </div>
                                            <div class="personal-info-item">
                                                <div class="personal-info-label">Last Login</div>
                                                <div class="personal-info-value">Today, 14:30</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Edit Mode -->
                                <div class="edit-form" id="personal-info-edit" style="display: none;">
                                    <div class="info-card">
                                        <div class="form-group">
                                            <label class="form-label fw-semibold">Full Name</label>
                                            <input type="text" class="form-control" id="edit-full-name" value="Thabo Mbeki">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label fw-semibold">Email Address</label>
                                            <input type="email" class="form-control" id="edit-email" value="thabo.mbeki@stokvelpro.co.za">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label fw-semibold">Phone Number</label>
                                            <input type="tel" class="form-control" id="edit-phone" value="+27 11 234 5678">
                                        </div>
                                    </div>
                                    
                                    <div class="info-card">
                                        <div class="form-group">
                                            <label class="form-label fw-semibold">Profile Picture</label>
                                            <div class="d-flex align-items-center gap-3">
                                                <img src="https://ui-avatars.com/api/?name=Thabo+Mbeki&background=1a472a&color=FFFFFF&size=80" id="edit-avatar-preview" class="rounded-circle" alt="Preview" style="width: 80px; height: 80px;">
                                                <div>
                                                    <button type="button" class="btn btn-outline-primary btn-sm" id="change-avatar-btn">
                                                        <i class="fas fa-camera me-2"></i>Change Photo
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-actions">
                                        <button type="button" class="btn btn-outline-secondary" id="cancel-edit-btn">
                                            <i class="fas fa-times me-2"></i>Cancel
                                        </button>
                                        <button type="button" class="btn btn-success" id="save-profile-btn">
                                            <i class="fas fa-save me-2"></i>Save Changes
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Security & Preferences Section -->
                            <div class="profile-section compact-section security-preferences-section">
                                <div class="section-header">
                                    <i class="fas fa-shield-alt fa-lg"></i>
                                    <h3 class="section-title">Security & Preferences</h3>
                                </div>
                                
                                <div class="equal-height-grid">
                                    <div class="equal-height-card">
                                        <div class="equal-height-content">
                                            <div class="security-preference-item">
                                                <div class="security-preference-label">Password Strength</div>
                                                <div class="security-preference-value">
                                                    <span class="badge bg-success">Strong</span>
                                                </div>
                                            </div>
                                            <div class="security-preference-item">
                                                <div class="security-preference-label">Two-Factor Authentication</div>
                                                <div class="security-preference-value">
                                                    <span class="badge bg-warning text-dark">Not Enabled</span>
                                                    <button class="btn btn-outline-primary btn-sm">Enable</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="equal-height-card">
                                        <div class="equal-height-content">
                                            <div class="security-preference-item">
                                                <div class="security-preference-label">Email Notifications</div>
                                                <div class="security-preference-value">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="email-notifications" checked>
                                                        <label class="form-check-label" for="email-notifications">Enabled</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="security-preference-item">
                                                <div class="security-preference-label">SMS Alerts</div>
                                                <div class="security-preference-value">
                                                    <div class="form-check form-switch">
                                                        <input class="form-check-input" type="checkbox" id="sms-alerts" checked>
                                                        <label class="form-check-label" for="sms-alerts">Enabled</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Security Dashboard Section -->
                            <div class="profile-section compact-section security-dashboard-section">
                                <div class="section-header">
                                    <i class="fas fa-shield-alt fa-lg"></i>
                                    <h3 class="section-title">Security Dashboard</h3>
                                </div>
                                
                                <div class="security-dashboard">
                                    <!-- Security Score -->
                                    <div class="security-score">
                                        <div class="score-circle">
                                            <span class="score" id="security-score">85</span>
                                        </div>
                                        <h5>Security Score</h5>
                                        <p class="text-muted small">Your overall security health</p>
                                    </div>

                                    <!-- Security Status -->
                                    <div class="security-status-card">
                                        <div class="security-metric">
                                            <span>Session Timeout</span>
                                            <span class="badge bg-success" id="session-timeout-status">Active</span>
                                        </div>
                                        <div class="security-metric">
                                            <span>Device Recognition</span>
                                            <span class="badge bg-success" id="device-recognition-status">Enabled</span>
                                        </div>
                                        <div class="security-metric">
                                            <span>Activity Monitoring</span>
                                            <span class="badge bg-success" id="activity-monitoring-status">Active</span>
                                        </div>
                                    </div>

                                    <!-- Security Features -->
                                    <h6 class="mb-3">Security Features</h6>
                                    <div class="security-features-list">
                                        <div class="security-feature" data-feature="session-timeout">
                                            <div class="feature-icon">
                                                <i class="fas fa-clock text-primary"></i>
                                            </div>
                                            <div class="feature-info">
                                                <h6 class="mb-1">Session Timeout</h6>
                                                <p class="mb-0 text-muted small">Automatically log out after inactivity</p>
                                            </div>
                                            <div class="feature-status">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="session-timeout-switch" checked>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="security-feature" data-feature="device-alerts">
                                            <div class="feature-icon">
                                                <i class="fas fa-laptop text-warning"></i>
                                            </div>
                                            <div class="feature-info">
                                                <h6 class="mb-1">New Device Alerts</h6>
                                                <p class="mb-0 text-muted small">Get notified when new devices access your account</p>
                                            </div>
                                            <div class="feature-status">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="device-alerts-switch" checked>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="security-feature" data-feature="activity-log">
                                            <div class="feature-icon">
                                                <i class="fas fa-history text-info"></i>
                                            </div>
                                            <div class="feature-info">
                                                <h6 class="mb-1">Activity Logging</h6>
                                                <p class="mb-0 text-muted small">Keep track of all account activities</p>
                                            </div>
                                            <div class="feature-status">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="activity-log-switch" checked>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Recent Activity -->
                                    <h6 class="mb-3 mt-4">Recent Security Activity</h6>
                                    <div class="activity-log" id="security-activity-log">
                                        <!-- Activity items will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer - FIXED -->
    <footer class="legal-footer">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="d-flex align-items-center">
                        <div class="logo-icon me-3">
                            <i class="fas fa-piggy-bank"></i>
                        </div>
                        <div>
                            <h5 class="mb-1 text-white">Stokvel Pro</h5>
                            <p class="text-muted small mb-0">Empowering Community Savings & Financial Management</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 text-md-end">
                    <div class="mt-3 mt-md-0">
                        <span class="badge bg-light text-primary me-2">FSCA Registered</span>
                        <span class="badge bg-warning text-dark me-2">POPIA Compliant</span>
                        <span class="badge bg-success me-2">Secure & Encrypted</span>
                        <span class="text-muted small d-block mt-2">Â© 2024 Stokvel Pro PTY Ltd. All rights reserved.</span>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12 text-center">
                    <small class="text-muted">
                        Stokvel Pro is a financial management platform only. We do not handle member funds or provide financial advice. 
                        <a href="#" class="text-white">Terms of Service</a> â€¢ 
                        <a href="#" class="text-white">Privacy Policy</a> â€¢ 
                        <a href="#" class="text-white">Compliance Information</a>
                    </small>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="bottom-nav d-md-none">
        <a href="#" class="nav-item active" data-tab="home-tab">
            <i class="fas fa-home nav-icon"></i>
            <span>Dashboard</span>
        </a>
        <a href="#" class="nav-item" data-tab="groups-tab">
            <i class="fas fa-users nav-icon"></i>
            <span>Groups</span>
        </a>
        <a href="#" class="nav-item" data-tab="notifications-tab">
            <i class="fas fa-bell nav-icon"></i>
            <span>Alerts</span>
        </a>
        <a href="#" class="nav-item" data-tab="profile-tab">
            <i class="fas fa-user nav-icon"></i>
            <span>Profile</span>
        </a>
    </nav>

    <!-- Encryption Settings Modal -->
    <div class="modal fade" id="encryptionSettingsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-lock me-2"></i>Message Encryption Settings
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Security Level Indicator -->
                    <div class="security-level-indicator">
                        <div>
                            <strong>Encryption Strength</strong>
                            <div class="text-muted small">AES-256-GCM + RSA-2048</div>
                        </div>
                        <div class="security-level-bar">
                            <div class="security-level-fill strong" id="security-level-fill"></div>
                        </div>
                        <span class="badge bg-success" id="security-level-text">Strong</span>
                    </div>

                    <!-- Current Encryption Status -->
                    <div class="encryption-settings">
                        <h6 class="mb-3">Current Configuration</h6>
                        
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Encryption Status</label>
                            <div class="encryption-status" id="modal-encryption-status">
                                <i class="fas fa-lock"></i>
                                <span>End-to-End Encrypted</span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Your Encryption Key</label>
                            <div class="encryption-key-display" id="user-key-display">
                                Loading...
                            </div>
                            <small class="text-muted">This key is used to encrypt your messages</small>
                        </div>

                        <div class="key-management">
                            <div>
                                <label class="form-label fw-semibold">Group Encryption Key</label>
                                <div class="text-muted small">Shared with all group members</div>
                            </div>
                            <button class="btn btn-outline-primary btn-sm" id="rotate-keys-btn">
                                <i class="fas fa-sync me-1"></i>Rotate Keys
                            </button>
                        </div>
                    </div>

                    <!-- Encryption Warning -->
                    <div class="encryption-warning">
                        <div class="d-flex align-items-start gap-2">
                            <i class="fas fa-exclamation-triangle text-warning mt-1"></i>
                            <div>
                                <strong>Important Security Notice</strong>
                                <p class="mb-0 small">Your messages are encrypted end-to-end. If you lose your encryption keys, you will not be able to read previous messages. Export and backup your keys regularly.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Export Keys Section -->
                    <div class="export-keys-section">
                        <h6 class="mb-3">Key Management</h6>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-primary" id="backup-keys-btn">
                                <i class="fas fa-download me-1"></i>Backup Keys
                            </button>
                            <button class="btn btn-outline-warning" id="import-keys-btn">
                                <i class="fas fa-upload me-1"></i>Import Keys
                            </button>
                            <button class="btn btn-outline-danger" id="reset-keys-btn">
                                <i class="fas fa-trash me-1"></i>Reset Keys
                            </button>
                        </div>
                    </div>

                    <!-- Help Section -->
                    <div class="encryption-help">
                        <h6 class="mb-3">How It Works</h6>
                        <div class="help-item">
                            <i class="fas fa-shield-alt help-icon"></i>
                            <div>
                                <strong>End-to-End Encryption</strong>
                                <p class="mb-0 small">Only you and the recipients can read messages. Not even Stokvel Pro can decrypt your conversations.</p>
                            </div>
                        </div>
                        <div class="help-item">
                            <i class="fas fa-key help-icon"></i>
                            <div>
                                <strong>Key Management</strong>
                                <p class="mb-0 small">Your encryption keys are stored locally in your browser. Back them up to avoid losing access.</p>
                            </div>
                        </div>
                        <div class="help-item">
                            <i class="fas fa-sync help-icon"></i>
                            <div>
                                <strong>Key Rotation</strong>
                                <p class="mb-0 small">Regularly rotate keys for enhanced security. Old messages remain accessible with previous keys.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="save-encryption-settings">
                        <i class="fas fa-save me-1"></i>Save Settings
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Add Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
// ===== SUPABASE INITIALIZATION =====
// Use environment variables or config file
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || 'https://kmujqhvywyykwaiwalys.supabase.co';
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || 'your-anon-key';

const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey)

// ===== SUPABASE AUTH FUNCTIONS =====
async function signUp(email, password, fullName) {
    try {
        const { data, error } = await supabase.auth.signUp({
            email: email,
            password: password,
            options: {
                data: {
                    full_name: fullName
                }
            }
        });
        
        if (error) throw error;
        
        if (data.user) {
            // Create profile in profiles table
            const { error: profileError } = await supabase
                .from('profiles')
                .insert([
                    { 
                        id: data.user.id, 
                        email: email,
                        full_name: fullName,
                        created_at: new Date().toISOString()
                    }
                ]);
            
            if (profileError) {
                console.error('Profile creation error:', profileError);
            }
            
            showToast('Account created successfully! Please check your email for verification.', 'success');
            return data.user;
        }
    } catch (error) {
        showToast(error.message, 'error');
        return null;
    }
}

async function signIn(email, password) {
    try {
        const { data, error } = await supabase.auth.signInWithPassword({
            email: email,
            password: password
        });
        
        if (error) throw error;
        
        showToast('Welcome back!', 'success');
        return data.user;
    } catch (error) {
        showToast(error.message, 'error');
        return null;
    }
}

async function signOut() {
    const { error } = await supabase.auth.signOut();
    if (!error) {
        showToast('Signed out successfully', 'info');
        window.location.reload();
    }
}

// Check auth state
async function checkAuthState() {
    const { data: { user } } = await supabase.auth.getUser();
    
    if (user) {
        document.body.classList.add('user-signed-in');
        updateUIForAuthenticatedUser(user);
    } else {
        document.body.classList.add('user-signed-out');
        showLoginModal();
    }
}

// ===== MAIN APP INITIALIZATION =====
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
    
    // Mobile optimizations
    if (window.innerWidth < 768) {
        document.body.classList.add('mobile-view');
        document.querySelectorAll('img').forEach(img => {
            img.loading = 'lazy';
        });
    }
});

// ===== STORAGE FUNCTIONS =====
const saveToStorage = (key, data) => {
    localStorage.setItem(`stokvel_${key}`, JSON.stringify(data));
};

const getFromStorage = (key, defaultValue) => {
    try {
        const stored = localStorage.getItem(`stokvel_${key}`);
        return stored ? JSON.parse(stored) : defaultValue;
    } catch (error) {
        console.error('Error reading from storage:', error);
        return defaultValue;
    }
};

// ===== UTILITY FUNCTIONS =====
function showToast(message, type = 'info', duration = 3000) {
    document.querySelectorAll('.alert[style*="position: fixed"]').forEach(toast => {
        toast.remove();
    });
    
    const toast = document.createElement('div');
    toast.className = `alert alert-${type} alert-dismissible fade show`;
    toast.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 250px;';
    toast.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentNode) toast.remove();
    }, duration);
}

function daysUntil(dateString) {
    const today = new Date();
    const eventDate = new Date(dateString);
    const diffTime = eventDate - today;
    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
}

// ===== MAIN APP INITIALIZER =====
async function initializeApp() {
    console.log('ðŸš€ Initializing Stokvel Pro with Supabase...');
    
    try {
        await checkAuthState();
        
        const { data: { user } } = await supabase.auth.getUser();
        if (user) {
            console.log('User authenticated, loading data...');
            
            initializeTabNavigation();
            initializeProfileFeatures();
            initializeChatFeatures();
            initializeQuickActions();
            initializeNotificationFeatures();
            
            await loadUserData();
        } else {
            console.log('No user authenticated, showing login modal');
            if (!document.getElementById('authModal')) {
                createAuthModal();
            }
        }
    } catch (error) {
        console.error('Error initializing app:', error);
        showToast('Error loading application', 'error');
    }
}

function createAuthModal() {
    console.log('Auth modal would be created here if needed');
}

async function loadUserData() {
    const groups = await getUserGroups();
    renderGroupsList(groups);
    initializeSmartContributions();
}

// ===== AUTH HELPER FUNCTIONS =====
function updateUIForAuthenticatedUser(user) {
    console.log('User authenticated:', user);
    const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
    if (authModal) authModal.hide();
    
    document.body.classList.add('user-signed-in');
    document.body.classList.remove('user-signed-out');
    addSignOutButton();
}

function showLoginModal() {
    const authModal = new bootstrap.Modal(document.getElementById('authModal'));
    authModal.show();
}

function showLoginForm() {
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('signupForm').style.display = 'none';
    document.querySelector('.modal-body > .d-grid').style.display = 'none';
}

function showSignupForm() {
    document.getElementById('signupForm').style.display = 'block';
    document.getElementById('loginForm').style.display = 'none';
    document.querySelector('.modal-body > .d-grid').style.display = 'none';
}

function showAuthOptions() {
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('signupForm').style.display = 'none';
    document.querySelector('.modal-body > .d-grid').style.display = 'grid';
}

async function handleLogin(event) {
    event.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    const user = await signIn(email, password);
    if (user) {
        const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
        if (authModal) authModal.hide();
        window.location.reload();
    }
}

async function handleSignup(event) {
    event.preventDefault();
    const name = document.getElementById('signupName').value;
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    
    const user = await signUp(email, password, name);
    if (user) {
        const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
        if (authModal) authModal.hide();
    }
}

function addSignOutButton() {
    const navbarNav = document.querySelector('.navbar-nav');
    if (navbarNav && !document.getElementById('sign-out-btn')) {
        const signOutItem = document.createElement('li');
        signOutItem.className = 'nav-item';
        signOutItem.innerHTML = `
            <a class="nav-link" href="#" id="sign-out-btn">
                <i class="fas fa-sign-out-alt me-1"></i>Sign Out
            </a>
        `;
        navbarNav.appendChild(signOutItem);
        
        document.getElementById('sign-out-btn').addEventListener('click', function(e) {
            e.preventDefault();
            signOut();
        });
    }
}

// ===== CORE FUNCTIONALITY =====
function initializeTabNavigation() {
    const tabLinks = document.querySelectorAll('[data-tab]');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            tabLinks.forEach(l => l.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            this.classList.add('active');
            const tabId = this.getAttribute('data-tab');
            const targetTab = document.getElementById(tabId);
            if (targetTab) {
                targetTab.classList.add('active');
                
                if (tabId === 'groups-tab') {
                    setTimeout(() => {
                        initializeAdvancedGroupManagement();
                    }, 100);
                }
            }
            
            if (this.classList.contains('nav-item')) {
                document.querySelectorAll('.bottom-nav .nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                this.classList.add('active');
            }
        });
    });
}

 function initializeProfileFeatures() {
    const editProfileBtn = document.getElementById('edit-profile-btn');
    const cancelEditBtn = document.getElementById('cancel-edit-btn');
    const saveProfileBtn = document.getElementById('save-profile-btn');
    const personalInfoView = document.getElementById('personal-info-view');
    const personalInfoEdit = document.getElementById('personal-info-edit');
    
    // Load profile data from Supabase
    loadProfileFromSupabase();
    
    if (editProfileBtn && personalInfoView && personalInfoEdit) {
        editProfileBtn.addEventListener('click', function() {
            personalInfoView.style.display = 'none';
            personalInfoEdit.style.display = 'block';
        });
    }
    
    if (cancelEditBtn && personalInfoView && personalInfoEdit) {
        cancelEditBtn.addEventListener('click', function() {
            personalInfoView.style.display = 'block';
            personalInfoEdit.style.display = 'none';
        });
    }
    
    if (saveProfileBtn && personalInfoView && personalInfoEdit) {
        saveProfileBtn.addEventListener('click', async function() {
            const fullName = document.getElementById('edit-full-name')?.value || 'Thabo Mbeki';
            const email = document.getElementById('edit-email')?.value || 'thabo.mbeki@stokvelpro.co.za';
            const phone = document.getElementById('edit-phone')?.value || '+27 11 234 5678';
            
            // Save to Supabase instead of localStorage
            const success = await updateProfile({
                full_name: fullName,
                email: email,
                phone: phone
            });
            
            if (success) {
                // Update view with new values
                const viewFullName = document.getElementById('view-full-name');
                const viewEmail = document.getElementById('view-email');
                const viewPhone = document.getElementById('view-phone');
                const welcomeName = document.getElementById('welcome-name');
                
                if (viewFullName) viewFullName.textContent = fullName;
                if (viewEmail) viewEmail.textContent = email;
                if (viewPhone) viewPhone.textContent = phone;
                if (welcomeName) welcomeName.textContent = fullName;
                
                // Switch back to view mode
                personalInfoView.style.display = 'block';
                personalInfoEdit.style.display = 'none';
            }
        });
    }
    
    // Avatar upload functionality remains the same
    // ... (keep existing avatar code)
}

async function loadProfileFromSupabase() {
    const profile = await getCurrentProfile();
    if (profile) {
        const editFullName = document.getElementById('edit-full-name');
        const editEmail = document.getElementById('edit-email');
        const editPhone = document.getElementById('edit-phone');
        
        if (editFullName) editFullName.value = profile.full_name || 'Thabo Mbeki';
        if (editEmail) editEmail.value = profile.email || 'thabo.mbeki@stokvelpro.co.za';
        if (editPhone) editPhone.value = profile.phone || '+27 11 234 5678';
        
        // Update view
        const viewFullName = document.getElementById('view-full-name');
        const viewEmail = document.getElementById('view-email');
        const viewPhone = document.getElementById('view-phone');
        const welcomeName = document.getElementById('welcome-name');
        
        if (viewFullName) viewFullName.textContent = profile.full_name || 'Thabo Mbeki';
        if (viewEmail) viewEmail.textContent = profile.email || 'thabo.mbeki@stokvelpro.co.za';
        if (viewPhone) viewPhone.textContent = profile.phone || '+27 11 234 5678';
        if (welcomeName) welcomeName.textContent = profile.full_name || 'Thabo Mbeki';
    }
}

    function initializeChatFeatures() {
        // Send message functionality
        const sendBtn = document.querySelector('.send-btn');
        if (sendBtn) {
            sendBtn.addEventListener('click', function() {
                const chatInput = document.querySelector('.chat-input');
                const message = chatInput?.value.trim();
                
                if (message && chatInput) {
                    addMessageToChat('You', message, true);
                    chatInput.value = '';
                    
                    // Simple auto-reply after 1 second
                    setTimeout(() => {
                        const replies = [
                            "Thanks for sharing!",
                            "I'll check that out",
                            "Great point!",
                            "Looking forward to discussing this"
                        ];
                        const randomReply = replies[Math.floor(Math.random() * replies.length)];
                        addMessageToChat('Sarah Johnson', randomReply, false);
                    }, 1000);
                }
            });
        }

        // File sharing
        const attachBtn = document.querySelector('.chat-action-btn[title="Attach file"]');
        if (attachBtn) {
            attachBtn.addEventListener('click', function() {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.pdf,.jpg,.png,.doc,.xlsx';
                
                fileInput.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        if (file.size > 10 * 1024 * 1024) {
                            showToast('File too large! Max 10MB', 'warning');
                            return;
                        }
                        addFileMessage(file.name, file.size);
                        showToast(`Shared ${file.name}`, 'success');
                    }
                };
                
                fileInput.click();
            });
        }
    }

    function addMessageToChat(sender, text, isOwn) {
        const chatMessages = document.getElementById('chatMessages');
        if (!chatMessages) return;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isOwn ? 'own' : ''}`;
        messageDiv.innerHTML = `
            <div class="message-avatar bg-${isOwn ? 'success' : 'primary'}">${sender.charAt(0)}</div>
            <div class="message-content">
                <div class="message-header">
                    <span class="message-sender">${sender}</span>
                    <span class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                </div>
                <div class="message-text">${text}</div>
            </div>
        `;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function addFileMessage(filename, size) {
        const chatMessages = document.getElementById('chatMessages');
        if (!chatMessages) return;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message own';
        messageDiv.innerHTML = `
            <div class="message-avatar bg-success">Y</div>
            <div class="message-content">
                <div class="message-header">
                    <span class="message-sender">You</span>
                    <span class="message-time">${new Date().toLocaleTimeString()}</span>
                </div>
                <div class="file-attachment">
                    <div class="file-icon">
                        <i class="fas fa-file-${getFileIcon(filename)}"></i>
                    </div>
                    <div class="file-info">
                        <div class="file-name">${filename}</div>
                        <div class="file-size">${formatFileSize(size)}</div>
                    </div>
                    <button class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
        `;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function getFileIcon(filename) {
        const ext = filename.split('.').pop().toLowerCase();
        if (['pdf'].includes(ext)) return 'pdf';
        if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return 'image';
        if (['doc', 'docx'].includes(ext)) return 'word';
        if (['xls', 'xlsx'].includes(ext)) return 'excel';
        return 'alt';
    }

    function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' bytes';
        if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / 1048576).toFixed(1) + ' MB';
    }

    function initializeQuickActions() {
        const actionCards = document.querySelectorAll('.action-card');
        actionCards.forEach(card => {
            card.addEventListener('click', function() {
                const action = this.getAttribute('data-action');
                
                if (action === 'contribution') {
                    const amount = prompt('How much are you contributing?', '2500');
                    if (amount && !isNaN(amount)) {
                        const contributions = getFromStorage('contributions', []);
                        contributions.push({
                            amount: parseFloat(amount),
                            date: new Date().toLocaleDateString(),
                            group: 'Investment Club'
                        });
                        saveToStorage('contributions', contributions);
                        
                        // Update UI
                        const savingsElement = document.querySelector('.stats-card.savings h3');
                        if (savingsElement) {
                            const current = parseInt(savingsElement.textContent.replace('R', '').replace(',', '')) || 0;
                            savingsElement.textContent = `R${(current + parseFloat(amount)).toLocaleString()}`;
                        }
                        
                        showToast(`Added R${amount} contribution!`, 'success');
                    }
                } else {
                    showToast(`${this.querySelector('h6')?.textContent || 'Action'} - Coming soon! ðŸš€`, 'info');
                }
            });
        });

        // Comment functionality
        const commentButtons = document.querySelectorAll('.comment-btn');
        commentButtons.forEach(button => {
            button.addEventListener('click', function() {
                const commentForm = this.closest('.activity-item')?.querySelector('.comment-form');
                if (commentForm) {
                    commentForm.style.display = commentForm.style.display === 'none' ? 'block' : 'none';
                }
            });
        });
        
        const cancelButtons = document.querySelectorAll('.cancel-comment');
        cancelButtons.forEach(button => {
            button.addEventListener('click', function() {
                const commentForm = this.closest('.comment-form');
                if (commentForm) {
                    commentForm.style.display = 'none';
                }
            });
        });
    }

    function initializeNotificationFeatures() {
        const markAllReadBtn = document.getElementById('mark-all-read');
        if (markAllReadBtn) {
            markAllReadBtn.addEventListener('click', function() {
                const unreadIndicators = document.querySelectorAll('.fa-circle.text-success');
                unreadIndicators.forEach(indicator => {
                    indicator.classList.remove('text-success');
                    indicator.classList.add('text-muted');
                });
                
                const notificationBadge = document.querySelector('.notification-badge');
                if (notificationBadge) {
                    notificationBadge.textContent = '0';
                }
                
                showToast('All notifications marked as read!', 'success');
            });
        }
    }

    // ===== PHASE 1-2 FEATURES =====
    function initializeGroupsFeatures() {
        initializeGroupMembers();
        initializeEvents();
        initializePolls();
    }

    function initializeGroupMembers() {
        const groupMembers = getFromStorage('group_members', [
            { name: 'Sarah Johnson', role: 'Admin', joined: '2024-01-15', avatar: 'SJ' },
            { name: 'Mike Chen', role: 'Treasurer', joined: '2024-02-01', avatar: 'MC' },
            { name: 'David Mokoena', role: 'Member', joined: '2024-02-15', avatar: 'DM' }
        ]);

        renderMembersList(groupMembers);

        const groupActionBtn = document.querySelector('[data-action="group"]');
        if (groupActionBtn) {
            groupActionBtn.addEventListener('click', function() {
                const friendName = prompt('Invite a friend to your group:');
                if (friendName) {
                    groupMembers.push({
                        name: friendName,
                        role: 'Member',
                        joined: new Date().toLocaleDateString(),
                        avatar: friendName.split(' ').map(n => n[0]).join('')
                    });
                    saveToStorage('group_members', groupMembers);
                    renderMembersList(groupMembers);
                    showToast(`Invited ${friendName} to the group!`, 'success');
                }
            });
        }
    }

    function renderMembersList(groupMembers) {
        const container = document.querySelector('.online-members');
        if (!container) return;
        
        if (!container.querySelector('h5') || container.querySelector('h5').textContent.includes('Online')) {
            container.innerHTML = '<h5 class="mb-3">Group Members</h5>';
            
            groupMembers.forEach(member => {
                const memberDiv = document.createElement('div');
                memberDiv.className = 'online-member';
                memberDiv.innerHTML = `
                    <div class="message-avatar bg-primary">${member.avatar}</div>
                    <div class="flex-grow-1">
                        <div class="fw-semibold">${member.name}</div>
                        <small class="text-muted">${member.role} â€¢ Joined ${member.joined}</small>
                    </div>
                    <div class="online-indicator"></div>
                `;
                container.appendChild(memberDiv);
            });
        }
    }

    function initializeEvents() {
        const groupEvents = getFromStorage('group_events', [
            { title: 'Monthly Meeting', date: '2024-03-25', type: 'meeting' },
            { title: 'Contribution Deadline', date: '2024-03-30', type: 'deadline' }
        ]);

        renderUpcomingEvents(groupEvents);

        const addEventBtn = document.getElementById('add-event-btn');
        if (addEventBtn) {
            addEventBtn.addEventListener('click', function() {
                addNewEvent(groupEvents);
            });
        }
    }

    function renderUpcomingEvents(groupEvents) {
        const eventsContainer = document.querySelector('.events-feed');
        if (!eventsContainer) return;
        
        if (eventsContainer.querySelector('h5')?.textContent.includes('Recent Activity')) {
            eventsContainer.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5>Upcoming Events</h5>
                    <button class="btn btn-umbrella btn-sm" id="add-event-btn">
                        <i class="fas fa-plus me-1"></i>Add Event
                    </button>
                </div>
            `;
            
            groupEvents.forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'event-item';
                eventDiv.innerHTML = `
                    <div class="event-icon bg-${event.type === 'meeting' ? 'primary' : 'warning'}">
                        <i class="fas fa-${event.type === 'meeting' ? 'users' : 'clock'}"></i>
                    </div>
                    <div class="event-content">
                        <h6 class="mb-1">${event.title}</h6>
                        <p class="text-muted mb-1">${new Date(event.date).toLocaleDateString()}</p>
                        <div class="event-meta">
                            <span><i class="fas fa-clock me-1"></i>In ${daysUntil(event.date)} days</span>
                        </div>
                    </div>
                `;
                eventsContainer.appendChild(eventDiv);
            });
        }
    }

    function addNewEvent(groupEvents) {
        const title = prompt('Event title:');
        const date = prompt('Event date (YYYY-MM-DD):', new Date().toISOString().split('T')[0]);
        
        if (title && date) {
            groupEvents.push({
                title,
                date,
                type: title.toLowerCase().includes('meeting') ? 'meeting' : 'deadline'
            });
            saveToStorage('group_events', groupEvents);
            renderUpcomingEvents(groupEvents);
            showToast('Event added!', 'success');
        }
    }

    function initializePolls() {
        const createPollBtn = document.querySelector('.btn-umbrella.btn-sm');
        if (createPollBtn && createPollBtn.textContent.includes('Create Poll')) {
            createPollBtn.addEventListener('click', function() {
                createNewPoll();
            });
        }

        const existingPoll = getFromStorage('current_poll', null);
        if (existingPoll) {
            renderPoll(existingPoll);
        }
    }

    function createNewPoll() {
        const question = prompt('Poll question:');
        if (!question) return;
        
        const options = [];
        let option;
        while ((option = prompt('Add an option (cancel to finish):'))) {
            options.push({ text: option, votes: 0 });
        }
        
        if (options.length < 2) {
            showToast('Need at least 2 options!', 'warning');
            return;
        }
        
        const poll = { question, options, totalVotes: 0 };
        saveToStorage('current_poll', poll);
        renderPoll(poll);
        showToast('Poll created!', 'success');
    }

    function renderPoll(poll) {
        const pollContainer = document.querySelector('.poll-container');
        if (!pollContainer) return;
        
        pollContainer.innerHTML = `
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5>Active Poll</h5>
            </div>
            <div class="poll-card">
                <h6>${poll.question}</h6>
                <p class="text-muted mb-3">${poll.totalVotes} votes so far</p>
                ${poll.options.map((option, index) => `
                    <div class="poll-option" data-index="${index}">
                        <span>${option.text}</span>
                        <div class="poll-stats">
                            <span class="poll-percentage">${poll.totalVotes ? Math.round((option.votes / poll.totalVotes) * 100) : 0}%</span>
                            <div class="poll-bar">
                                <div class="poll-fill" style="width: ${poll.totalVotes ? (option.votes / poll.totalVotes) * 100 : 0}%"></div>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
        
        pollContainer.querySelectorAll('.poll-option').forEach(option => {
            option.addEventListener('click', function() {
                const index = parseInt(this.getAttribute('data-index'));
                voteInPoll(index);
            });
        });
    }

    function voteInPoll(optionIndex) {
        const poll = getFromStorage('current_poll');
        if (!poll) return;
        
        poll.options[optionIndex].votes++;
        poll.totalVotes++;
        saveToStorage('current_poll', poll);
        renderPoll(poll);
        showToast('Vote counted!', 'success');
    }

    // ===== PHASE 3 FEATURES =====
    function initializeSavingsGoals() {
        const savingsGoals = getFromStorage('savings_goals', [
            { name: 'New Car', target: 150000, current: 45820, deadline: '2024-12-31', color: 'primary' },
            { name: 'Home Renovation', target: 80000, current: 25000, deadline: '2024-08-31', color: 'success' },
            { name: 'Emergency Fund', target: 50000, current: 32000, color: 'warning' }
        ]);

        renderSavingsGoals(savingsGoals);
        
        document.querySelector('[data-action="report"]')?.addEventListener('click', function() {
            createNewGoal(savingsGoals);
        });
    }

    function renderSavingsGoals(goals) {
        // Check if goals already exist to avoid duplicates
        if (document.getElementById('savings-goals-container')) return;
        
        const goalsContainer = document.createElement('div');
        goalsContainer.className = 'card mt-4';
        goalsContainer.innerHTML = `
            <div class="card-header py-3">
                <h5 class="mb-0"><i class="fas fa-bullseye me-2 text-primary"></i>Savings Goals</h5>
            </div>
            <div class="card-body" id="savings-goals-container">
                ${goals.map(goal => `
                    <div class="goal-item mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">${goal.name}</h6>
                            <span class="badge bg-${goal.color}">R${goal.current.toLocaleString()} / R${goal.target.toLocaleString()}</span>
                        </div>
                        <div class="progress-container mb-2">
                            <div class="progress-fill" style="width: ${(goal.current / goal.target) * 100}%; background: var(--gradient-${goal.color})"></div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">${Math.round((goal.current / goal.target) * 100)}% complete</small>
                            ${goal.deadline ? `<small class="text-muted">Due: ${new Date(goal.deadline).toLocaleDateString()}</small>` : ''}
                        </div>
                    </div>
                `).join('')}
                <button class="btn btn-outline-primary btn-sm w-100 mt-2" id="add-goal-btn">
                    <i class="fas fa-plus me-1"></i>Add New Goal
                </button>
            </div>
        `;

        const groupPerformanceCard = document.querySelector('.card .btn-outline-primary');
        if (groupPerformanceCard) {
            groupPerformanceCard.closest('.card').after(goalsContainer);
        }

        document.getElementById('add-goal-btn')?.addEventListener('click', () => {
            createNewGoal(goals);
        });
    }

    function createNewGoal(goals) {
        const name = prompt('Goal name:');
        const target = parseFloat(prompt('Target amount (R):'));
        const deadline = prompt('Deadline (YYYY-MM-DD) - optional:');
        
        if (name && target) {
            const colors = ['primary', 'success', 'warning', 'danger'];
            const newGoal = {
                name,
                target,
                current: 0,
                deadline: deadline || null,
                color: colors[Math.floor(Math.random() * colors.length)]
            };
            
            goals.push(newGoal);
            saveToStorage('savings_goals', goals);
            renderSavingsGoals(goals);
            showToast(`New goal "${name}" created!`, 'success');
        }
    }

    function initializeFinancialInsights() {
        const contributions = getFromStorage('contributions', []);
        const spending = getFromStorage('spending', [
            { category: 'Groceries', amount: 1500, date: '2024-03-10' },
            { category: 'Transport', amount: 800, date: '2024-03-12' },
            { category: 'Entertainment', amount: 600, date: '2024-03-14' }
        ]);

        if (contributions.length > 0 || spending.length > 0) {
            renderFinancialInsights(contributions, spending);
        }
    }

    function renderFinancialInsights(contributions, spending) {
        // Avoid duplicates
        if (document.querySelector('.fa-chart-line')) return;
        
        const totalContributions = contributions.reduce((sum, c) => sum + c.amount, 0);
        const totalSpending = spending.reduce((sum, s) => sum + s.amount, 0);
        const savingsRate = totalContributions > 0 ? ((totalContributions - totalSpending) / totalContributions) * 100 : 0;

        const insightsHTML = `
            <div class="card mt-4">
                <div class="card-header py-3">
                    <h5 class="mb-0"><i class="fas fa-chart-line me-2 text-success"></i>Financial Insights</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="text-success">
                                <h4>R${totalContributions.toLocaleString()}</h4>
                                <small>Total Saved</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="text-warning">
                                <h4>R${totalSpending.toLocaleString()}</h4>
                                <small>This Month</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="${savingsRate >= 0 ? 'text-primary' : 'text-danger'}">
                                <h4>${Math.round(savingsRate)}%</h4>
                                <small>Savings Rate</small>
                            </div>
                        </div>
                    </div>
                    
                    ${spending.length > 0 ? `
                        <div class="mt-3">
                            <h6>Spending by Category</h6>
                            ${renderSpendingChart(spending)}
                        </div>
                    ` : ''}
                    
                    <button class="btn btn-outline-primary btn-sm w-100 mt-3" id="add-spending-btn">
                        <i class="fas fa-plus me-1"></i>Add Expense
                    </button>
                </div>
            </div>
        `;

        const goalsCard = document.querySelector('#savings-goals-container');
        if (goalsCard) {
            goalsCard.closest('.card').after(insightsHTML);
        }

        document.getElementById('add-spending-btn')?.addEventListener('click', () => {
            addNewExpense(spending);
        });
    }

    function renderSpendingChart(spending) {
        const categories = {};
        spending.forEach(item => {
            categories[item.category] = (categories[item.category] || 0) + item.amount;
        });

        return Object.entries(categories).map(([category, amount]) => `
            <div class="mb-2">
                <div class="d-flex justify-content-between mb-1">
                    <span>${category}</span>
                    <span class="fw-semibold">R${amount}</span>
                </div>
                <div class="progress-container">
                    <div class="progress-fill" style="width: ${(amount / Math.max(...Object.values(categories))) * 100}%"></div>
                </div>
            </div>
        `).join('');
    }

    function addNewExpense(spending) {
        const category = prompt('Expense category:');
        const amount = parseFloat(prompt('Amount (R):'));
        
        if (category && amount) {
            spending.push({
                category,
                amount,
                date: new Date().toISOString().split('T')[0]
            });
            saveToStorage('spending', spending);
            initializeFinancialInsights();
            showToast(`Added ${category} expense`, 'info');
        }
    }

    function initializeAchievements() {
        const achievements = getFromStorage('achievements', [
            { id: 'early_bird', name: 'Early Bird', description: 'Make 3 contributions before due date', earned: true, icon: 'â°' },
            { id: 'savings_star', name: 'Savings Star', description: 'Save over R10,000 in a month', earned: false, icon: 'â­' },
            { id: 'group_champ', name: 'Group Champion', description: 'Most active in group chats', earned: true, icon: 'ðŸ†' },
            { id: 'consistent', name: 'Consistent Saver', description: '6 months of on-time payments', earned: false, icon: 'ðŸ“ˆ' }
        ]);

        renderAchievements(achievements);
    }

    function renderAchievements(achievements) {
        // Avoid duplicates
        if (document.querySelector('.fa-trophy')) return;
        
        const earned = achievements.filter(a => a.earned);
        const pending = achievements.filter(a => !a.earned);

        const achievementsHTML = `
            <div class="card mt-4">
                <div class="card-header py-3">
                    <h5 class="mb-0"><i class="fas fa-trophy me-2 text-warning"></i>Achievements</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center mb-3">
                        <div class="col-6">
                            <div class="text-success">
                                <h3>${earned.length}</h3>
                                <small>Earned</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-muted">
                                <h3>${pending.length}</h3>
                                <small>Pending</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="achievements-grid">
                        ${achievements.map(achievement => `
                            <div class="achievement-item ${achievement.earned ? 'earned' : 'locked'}">
                                <div class="achievement-icon">${achievement.icon}</div>
                                <div class="achievement-info">
                                    <strong>${achievement.name}</strong>
                                    <small>${achievement.description}</small>
                                </div>
                                ${achievement.earned ? '<i class="fas fa-check text-success"></i>' : '<i class="fas fa-lock text-muted"></i>'}
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;

        const profileContent = document.querySelector('.profile-content');
        if (profileContent) {
            const securitySection = document.querySelector('.security-preferences-section');
            if (securitySection) {
                securitySection.insertAdjacentHTML('afterend', achievementsHTML);
            }
        }
    }

    function initializeReminders() {
        const reminders = getFromStorage('reminders', [
            { type: 'monthly', amount: 2500, dueDate: '2024-03-30', group: 'Investment Club', completed: false },
            { type: 'weekly', amount: 500, dueDate: '2024-03-15', group: 'Emergency Fund', completed: true }
        ]);

        checkUpcomingReminders(reminders);
        renderReminders(reminders);
    }

    function checkUpcomingReminders(reminders) {
        const today = new Date();
        const upcoming = reminders.filter(reminder => {
            if (reminder.completed) return false;
            const dueDate = new Date(reminder.dueDate);
            const daysUntilDue = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
            return daysUntilDue <= 3 && daysUntilDue >= 0;
        });

        if (upcoming.length > 0) {
            showToast(`ðŸ”” You have ${upcoming.length} upcoming contribution(s) due soon!`, 'warning');
        }
    }

    function renderReminders(reminders) {
        const remindersHTML = reminders.map(reminder => `
            <div class="list-group-item ${reminder.completed ? 'opacity-50' : ''}">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1">${reminder.type.charAt(0).toUpperCase() + reminder.type.slice(1)} Contribution</h6>
                        <p class="mb-1 text-muted">${reminder.group} - R${reminder.amount}</p>
                        <small class="text-muted">Due: ${new Date(reminder.dueDate).toLocaleDateString()}</small>
                    </div>
                    <div>
                        ${reminder.completed ? 
                            '<span class="badge bg-success">Paid</span>' : 
                            '<button class="btn btn-sm btn-success mark-paid-btn">Mark Paid</button>'
                        }
                    </div>
                </div>
            </div>
        `).join('');

        const notificationsList = document.getElementById('notifications-list');
        if (notificationsList) {
            notificationsList.innerHTML = remindersHTML + notificationsList.innerHTML;
            
            document.querySelectorAll('.mark-paid-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reminderText = this.closest('.list-group-item').querySelector('h6').textContent;
                    showToast(`Marked ${reminderText} as paid!`, 'success');
                    this.innerHTML = '<span class="badge bg-success">Paid</span>';
                    this.classList.replace('btn-success', 'badge');
                });
            });
        }
    }

    // ===== PHASE 4 FEATURES =====
    function initializePaymentScheduling() {
        const scheduledPayments = getFromStorage('scheduled_payments', [
            { id: 1, type: 'recurring', amount: 2500, frequency: 'monthly', nextDate: '2024-04-01', group: 'Investment Club', active: true },
            { id: 2, type: 'recurring', amount: 1000, frequency: 'weekly', nextDate: '2024-03-22', group: 'Emergency Fund', active: true },
            { id: 3, type: 'one-time', amount: 5000, date: '2024-03-25', group: 'Family Savings', active: true }
        ]);

        renderPaymentScheduling(scheduledPayments);
        checkUpcomingScheduledPayments(scheduledPayments);
    }

    function renderPaymentScheduling(payments) {
        // Avoid duplicates
        if (document.querySelector('.fa-clock')) return;
        
        const schedulingHTML = `
            <div class="card mt-4">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-clock me-2 text-primary"></i>Scheduled Payments</h5>
                    <button class="btn btn-umbrella btn-sm" id="schedule-payment-btn">
                        <i class="fas fa-plus me-1"></i>Schedule Payment
                    </button>
                </div>
                <div class="card-body">
                    ${payments.length > 0 ? payments.map(payment => `
                        <div class="scheduled-payment-item ${payment.active ? '' : 'opacity-50'}">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="flex-grow-1">
                                    <div class="d-flex align-items-center mb-1">
                                        <h6 class="mb-0 me-2">R${payment.amount} - ${payment.group}</h6>
                                        <span class="badge bg-${payment.type === 'recurring' ? 'primary' : 'warning'}">
                                            ${payment.type === 'recurring' ? payment.frequency : 'One-time'}
                                        </span>
                                        ${!payment.active ? '<span class="badge bg-secondary ms-1">Paused</span>' : ''}
                                    </div>
                                    <small class="text-muted">
                                        ${payment.type === 'recurring' ? 'Next: ' : 'Due: '}
                                        ${new Date(payment.nextDate || payment.date).toLocaleDateString()}
                                    </small>
                                </div>
                                <div class="payment-actions">
                                    ${payment.active ? `
                                        <button class="btn btn-sm btn-outline-warning pause-payment-btn" data-id="${payment.id}">
                                            <i class="fas fa-pause"></i>
                                        </button>
                                    ` : `
                                        <button class="btn btn-sm btn-outline-success resume-payment-btn" data-id="${payment.id}">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    `}
                                    <button class="btn btn-sm btn-outline-danger delete-payment-btn" data-id="${payment.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('') : `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-clock fa-3x mb-3 opacity-50"></i>
                            <p>No scheduled payments yet</p>
                            <button class="btn btn-umbrella" id="setup-scheduling-btn">
                                <i class="fas fa-plus me-1"></i>Set Up Your First Payment
                            </button>
                        </div>
                    `}
                </div>
            </div>
        `;

        const homeTab = document.getElementById('home-tab');
        if (homeTab) {
            const goalsCard = homeTab.querySelector('#savings-goals-container');
            if (goalsCard) {
                goalsCard.closest('.card').insertAdjacentHTML('afterend', schedulingHTML);
            } else {
                const performanceCard = homeTab.querySelector('.fa-trophy');
                if (performanceCard) {
                    performanceCard.closest('.card').insertAdjacentHTML('afterend', schedulingHTML);
                }
            }
        }

        document.getElementById('schedule-payment-btn')?.addEventListener('click', () => {
            scheduleNewPayment(payments);
        });

        document.getElementById('setup-scheduling-btn')?.addEventListener('click', () => {
            scheduleNewPayment(payments);
        });

        initializePaymentActions(payments);
    }

    function scheduleNewPayment(payments) {
        const type = confirm('Set up recurring payment?\n\nClick OK for recurring payment\nClick Cancel for one-time payment') ? 'recurring' : 'one-time';
        const amount = parseFloat(prompt('Amount (R):'));
        const group = prompt('Group name:');
        
        if (amount && group) {
            let frequency, nextDate;
            
            if (type === 'recurring') {
                frequency = prompt('Frequency (weekly/monthly):');
                nextDate = prompt('Start date (YYYY-MM-DD):', new Date().toISOString().split('T')[0]);
            } else {
                nextDate = prompt('Payment date (YYYY-MM-DD):', new Date().toISOString().split('T')[0]);
            }
            
            if ((type === 'recurring' && frequency && nextDate) || (type === 'one-time' && nextDate)) {
                const newPayment = {
                    id: Date.now(),
                    type,
                    amount,
                    group,
                    active: true,
                    ...(type === 'recurring' ? { frequency, nextDate } : { date: nextDate })
                };
                
                payments.push(newPayment);
                saveToStorage('scheduled_payments', payments);
                renderPaymentScheduling(payments);
                showToast('ðŸ’° Payment scheduled successfully!', 'success');
            }
        }
    }

    function initializePaymentActions(payments) {
        document.querySelectorAll('.pause-payment-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const paymentId = parseInt(this.getAttribute('data-id'));
                const payment = payments.find(p => p.id === paymentId);
                if (payment) {
                    payment.active = false;
                    saveToStorage('scheduled_payments', payments);
                    renderPaymentScheduling(payments);
                    showToast('â¸ï¸ Payment paused', 'warning');
                }
            });
        });

        document.querySelectorAll('.resume-payment-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const paymentId = parseInt(this.getAttribute('data-id'));
                const payment = payments.find(p => p.id === paymentId);
                if (payment) {
                    payment.active = true;
                    saveToStorage('scheduled_payments', payments);
                    renderPaymentScheduling(payments);
                    showToast('â–¶ï¸ Payment resumed', 'success');
                }
            });
        });

        document.querySelectorAll('.delete-payment-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const paymentId = parseInt(this.getAttribute('data-id'));
                const paymentIndex = payments.findIndex(p => p.id === paymentId);
                if (paymentIndex > -1 && confirm('Are you sure you want to delete this scheduled payment?')) {
                    payments.splice(paymentIndex, 1);
                    saveToStorage('scheduled_payments', payments);
                    renderPaymentScheduling(payments);
                    showToast('ðŸ—‘ï¸ Payment deleted', 'info');
                }
            });
        });
    }

    function checkUpcomingScheduledPayments(payments) {
        const today = new Date();
        const upcoming = payments.filter(payment => {
            if (!payment.active) return false;
            const paymentDate = new Date(payment.nextDate || payment.date);
            const daysUntil = Math.ceil((paymentDate - today) / (1000 * 60 * 60 * 24));
            return daysUntil <= 1 && daysUntil >= 0;
        });

        upcoming.forEach(payment => {
            showToast(`ðŸ’° Scheduled payment of R${payment.amount} to ${payment.group} due tomorrow!`, 'info');
        });
    }

    function initializeAdvancedGroupManagement() {
        // Advanced Group Management feature removed
        console.log('Advanced Group Management feature removed');
    }

    function enhanceMobileExperience() {
        initializeTouchGestures();
        enhanceOfflineSupport();
        optimizeForMobile();
        initializeMobileQuickActions();
    }

    function initializeTouchGestures() {
        let startX, startY;
        
        document.addEventListener('touchstart', e => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });
        
        document.addEventListener('touchend', e => {
            if (!startX || !startY) return;
            
            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            
            const diffX = endX - startX;
            const diffY = endY - startY;
            
            if (Math.abs(diffX) > 50 && Math.abs(diffX) > Math.abs(diffY)) {
                if (diffX > 0) {
                    switchToAdjacentTab(-1);
                } else {
                    switchToAdjacentTab(1);
                }
            }
            
            startX = startY = null;
        });
    }

    function switchToAdjacentTab(direction) {
        const tabs = Array.from(document.querySelectorAll('.bottom-nav .nav-item'));
        const currentIndex = tabs.findIndex(tab => tab.classList.contains('active'));
        const newIndex = (currentIndex + direction + tabs.length) % tabs.length;
        
        if (tabs[newIndex]) {
            tabs[newIndex].click();
            showToast(`ðŸ“± Switched to ${tabs[newIndex].querySelector('span').textContent}`, 'info', 1000);
        }
    }

    function enhanceOfflineSupport() {
        const cacheData = {
            profile: getFromStorage('profile', {}),
            groups: getFromStorage('advanced_groups', []),
            contributions: getFromStorage('contributions', []),
            payments: getFromStorage('scheduled_payments', [])
        };
        
        localStorage.setItem('stokvel_offline_cache', JSON.stringify(cacheData));
        
        if (!document.getElementById('offline-indicator')) {
            const offlineIndicator = document.createElement('div');
            offlineIndicator.id = 'offline-indicator';
            offlineIndicator.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: #f59e0b;
                color: white;
                padding: 8px;
                text-align: center;
                font-size: 0.9rem;
                z-index: 9999;
                display: none;
            `;
            offlineIndicator.innerHTML = `
                <i class="fas fa-wifi-slash me-2"></i>
                You're currently offline - some features may be limited
            `;
            document.body.appendChild(offlineIndicator);
        }
        
        window.addEventListener('online', () => {
            const indicator = document.getElementById('offline-indicator');
            if (indicator) indicator.style.display = 'none';
            showToast('ðŸŒ Back online! Syncing your data...', 'success');
        });
        
        window.addEventListener('offline', () => {
            const indicator = document.getElementById('offline-indicator');
            if (indicator) indicator.style.display = 'block';
            showToast('ðŸ“¶ You are now offline', 'warning', 2000);
        });
    }

    function optimizeForMobile() {
        if (window.innerWidth < 768) {
            document.querySelectorAll('.btn, .action-card, .nav-item').forEach(el => {
                el.style.minHeight = '44px';
                if (el.classList.contains('btn') || el.classList.contains('action-card')) {
                    el.style.padding = '12px 8px';
                }
            });
            
            document.querySelectorAll('.card').forEach(card => {
                card.style.marginBottom = '1rem';
            });
            
            document.querySelectorAll('.row.g-4').forEach(row => {
                row.className = row.className.replace('g-4', 'g-3');
            });
        }
    }

    function initializeMobileQuickActions() {
        if (window.innerWidth < 768) {
            createMobileQuickActionButton();
        }
    }

    function createMobileQuickActionButton() {
        if (document.getElementById('mobile-quick-action-btn')) return;
        
        const quickActionBtn = document.createElement('button');
        quickActionBtn.id = 'mobile-quick-action-btn';
        quickActionBtn.innerHTML = '<i class="fas fa-bolt"></i>';
        quickActionBtn.style.cssText = `
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            border: none;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        `;
        
        quickActionBtn.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.1)';
        });
        
        quickActionBtn.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
        
        quickActionBtn.addEventListener('click', function() {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => this.style.transform = 'scale(1)', 150);
            showMobileQuickActions();
        });
        
        document.body.appendChild(quickActionBtn);
    }

    function showMobileQuickActions() {
        const actions = [
            { icon: 'fas fa-money-bill-wave', label: 'Add Contribution', action: 'contribution', color: 'success' },
            { icon: 'fas fa-comment', label: 'Quick Message', action: 'message', color: 'primary' },
            { icon: 'fas fa-calendar-plus', label: 'Add Event', action: 'event', color: 'warning' },
            { icon: 'fas fa-chart-line', label: 'Quick Report', action: 'report', color: 'info' },
            { icon: 'fas fa-users', label: 'New Group', action: 'group', color: 'secondary' },
            { icon: 'fas fa-clock', label: 'Schedule Payment', action: 'schedule', color: 'primary' }
        ];
        
        const modalHTML = `
            <div class="modal fade" id="mobileQuickActions" tabindex="-1">
                <div class="modal-dialog modal-bottom">
                    <div class="modal-content" style="border-radius: 20px 20px 0 0;">
                        <div class="modal-header border-0">
                            <h5 class="modal-title">Quick Actions</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row g-3">
                                ${actions.map(action => `
                                    <div class="col-4">
                                        <button class="btn btn-${action.color} w-100 h-100 mobile-quick-action p-3" 
                                                data-action="${action.action}"
                                                style="border-radius: 12px; min-height: 100px;">
                                            <i class="${action.icon} fa-2x mb-2 d-block"></i>
                                            <small class="fw-semibold">${action.label}</small>
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="mt-4 pt-3 border-top">
                                <h6 class="text-muted mb-3">Recent</h6>
                                <div class="recent-actions">
                                    <div class="d-flex justify-content-between align-items-center py-2">
                                        <small>ðŸ’° R2,500 to Investment Club</small>
                                        <small class="text-muted">2h ago</small>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center py-2">
                                        <small>ðŸ“… Monthly meeting</small>
                                        <small class="text-muted">Yesterday</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        const modal = new bootstrap.Modal(document.getElementById('mobileQuickActions'));
        modal.show();
        
        document.querySelectorAll('.mobile-quick-action').forEach(btn => {
            btn.addEventListener('click', function() {
                const action = this.getAttribute('data-action');
                handleMobileQuickAction(action);
            });
        });
        
        document.getElementById('mobileQuickActions').addEventListener('hidden.bs.modal', function() {
            this.remove();
        });
    }

    function handleMobileQuickAction(action) {
        const actions = {
            contribution: () => {
                const amount = prompt('ðŸ’³ Contribution amount (R):', '2500');
                if (amount && !isNaN(amount)) {
                    const contributions = getFromStorage('contributions', []);
                    contributions.push({
                        amount: parseFloat(amount),
                        date: new Date().toLocaleDateString(),
                        group: 'Quick Contribution'
                    });
                    saveToStorage('contributions', contributions);
                    showToast(`âœ… Added R${amount} contribution!`, 'success');
                }
            },
            message: () => {
                const message = prompt('ðŸ’¬ Quick message to group:');
                if (message) {
                    const chatInput = document.querySelector('.chat-input');
                    if (chatInput) {
                        chatInput.value = message;
                        document.querySelector('.send-btn')?.click();
                    }
                    showToast('ðŸ“¤ Message sent!', 'success');
                }
            },
            event: () => {
                const title = prompt('ðŸ“… Event title:');
                if (title) {
                    const events = getFromStorage('group_events', []);
                    events.push({
                        title,
                        date: new Date().toISOString().split('T')[0],
                        type: 'meeting'
                    });
                    saveToStorage('group_events', events);
                    showToast(`ðŸŽ‰ Event "${title}" added!`, 'success');
                }
            },
            report: () => {
                showToast('ðŸ“Š Generating quick report...', 'info');
                setTimeout(() => {
                    showToast('âœ… Quick report ready!', 'success');
                }, 1500);
            },
            group: () => {
                const groupName = prompt('ðŸ‘¥ New group name:');
                if (groupName) {
                    showToast(`ðŸŽ‰ Created "${groupName}" group!`, 'success');
                }
            },
            schedule: () => {
                const amount = prompt('â° Schedule payment amount (R):', '1000');
                if (amount) {
                    showToast(`ðŸ’° Scheduled R${amount} payment!`, 'success');
                }
            }
        };
        
        if (actions[action]) {
            actions[action]();
            const modal = bootstrap.Modal.getInstance(document.getElementById('mobileQuickActions'));
            if (modal) modal.hide();
        }
    }

    // ===== SMART CONTRIBUTION SUGGESTIONS =====
    function initializeSmartContributions() {
        console.log('ðŸ’¡ Initializing Smart Contributions...');
        
        const contributionData = analyzeContributionPatterns();
        const groupInsights = generateGroupInsights();
        const personalizedSuggestions = generateSuggestions(contributionData, groupInsights);
        
        renderSmartContributions(personalizedSuggestions, contributionData);
        setupContributionActions();
    }

    function analyzeContributionPatterns() {
        const contributions = getFromStorage('contributions', []);
        const groups = getFromStorage('groups_data', []);
        
        // Calculate basic statistics
        const totalContributions = contributions.reduce((sum, c) => sum + c.amount, 0);
        const averageContribution = contributions.length > 0 ? totalContributions / contributions.length : 0;
        
        // Analyze timing patterns
        const monthlyPattern = analyzeMonthlyPattern(contributions);
        const bestDays = findBestContributionDays(contributions);
        
        return {
            totalContributions,
            averageContribution: Math.round(averageContribution),
            totalCount: contributions.length,
            monthlyPattern,
            bestDays,
            consistencyScore: calculateConsistency(contributions),
            recentActivity: getRecentActivity(contributions)
        };
    }

    function analyzeMonthlyPattern(contributions) {
        const monthlyTotals = {};
        const currentMonth = new Date().toISOString().substring(0, 7); // YYYY-MM
        
        contributions.forEach(contribution => {
            const month = contribution.date.substring(0, 7);
            monthlyTotals[month] = (monthlyTotals[month] || 0) + contribution.amount;
        });
        
        return {
            currentMonth: monthlyTotals[currentMonth] || 0,
            previousMonth: monthlyTotals[getPreviousMonth(currentMonth)] || 0,
            monthlyAverage: Object.values(monthlyTotals).reduce((a, b) => a + b, 0) / Object.keys(monthlyTotals).length || 0
        };
    }

    function findBestContributionDays(contributions) {
        const dayCounts = {};
        
        contributions.forEach(contribution => {
            const day = new Date(contribution.date).getDate();
            dayCounts[day] = (dayCounts[day] || 0) + 1;
        });
        
        // Find most common contribution days
        const sortedDays = Object.entries(dayCounts)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 3)
            .map(([day]) => parseInt(day));
        
        return sortedDays.length > 0 ? sortedDays : [25, 30, 15]; // Default payday patterns
    }

    function calculateConsistency(contributions) {
        if (contributions.length < 2) return 100;
        
        const monthlyData = {};
        contributions.forEach(contribution => {
            const month = contribution.date.substring(0, 7);
            if (!monthlyData[month]) monthlyData[month] = 0;
            monthlyData[month]++;
        });
        
        const months = Object.keys(monthlyData).length;
        const averagePerMonth = contributions.length / months;
        const variance = Object.values(monthlyData).reduce((sum, count) => {
            return sum + Math.pow(count - averagePerMonth, 2);
        }, 0) / months;
        
        const consistency = Math.max(0, 100 - (variance * 10));
        return Math.round(consistency);
    }

    function generateGroupInsights() {
        const groups = getFromStorage('groups_data', [
            { name: 'Investment Club', target: 2500, members: 12 },
            { name: 'Family Savings', target: 1500, members: 8 },
            { name: 'Emergency Fund', target: 1000, members: 6 }
        ]);
        
        return {
            groupAverages: groups.map(group => ({
                name: group.name,
                average: group.target,
                members: group.members
            })),
            totalGroups: groups.length,
            suggestedAmounts: calculateSuggestedAmounts(groups)
        };
    }

    function calculateSuggestedAmounts(groups) {
        const averages = groups.map(g => g.target);
        const min = Math.min(...averages);
        const max = Math.max(...averages);
        const median = averages.sort((a, b) => a - b)[Math.floor(averages.length / 2)];
        
        return {
            conservative: min,
            moderate: median,
            aggressive: max,
            balanced: Math.round((min + median + max) / 3)
        };
    }

    function generateSuggestions(contributionData, groupInsights) {
        const suggestions = [];
        
        // Suggestion 1: Based on group averages
        if (contributionData.averageContribution < groupInsights.suggestedAmounts.balanced) {
            suggestions.push({
                type: 'increase',
                title: 'Consider Increasing Contribution',
                message: `Your average contribution (R${contributionData.averageContribution}) is below the group balanced average of R${groupInsights.suggestedAmounts.balanced}`,
                icon: 'fas fa-chart-line',
                priority: 'medium'
            });
        }
        
        // Suggestion 2: Consistency improvement
        if (contributionData.consistencyScore < 70) {
            suggestions.push({
                type: 'consistency',
                title: 'Improve Contribution Consistency',
                message: `Your consistency score is ${contributionData.consistencyScore}%. Try contributing on the same days each month.`,
                icon: 'fas fa-calendar-check',
                priority: 'high'
            });
        }
        
        // Suggestion 3: Timing optimization
        const bestDays = contributionData.bestDays.join(', ');
        suggestions.push({
            type: 'timing',
            title: 'Optimal Contribution Timing',
            message: `Most successful contributions happen around days ${bestDays} of the month (common paydays)`,
            icon: 'fas fa-clock',
            priority: 'low'
        });
        
        // Suggestion 4: Monthly target
        const monthlyShortfall = groupInsights.suggestedAmounts.balanced - contributionData.monthlyPattern.currentMonth;
        if (monthlyShortfall > 0) {
            suggestions.push({
                type: 'target',
                title: 'Monthly Target Progress',
                message: `You're R${monthlyShortfall} away from this month's balanced contribution target`,
                icon: 'fas fa-bullseye',
                priority: 'medium'
            });
        }
        
        return suggestions;
    }

    function renderSmartContributions(suggestions, contributionData) {
        const container = document.getElementById('smart-contributions-container');
        if (!container) return;
        
        // Contribution Statistics
        const statsHTML = `
            <div class="contribution-stats">
                <div class="stat-item">
                    <span class="stat-value">R${contributionData.averageContribution.toLocaleString()}</span>
                    <span class="stat-label">Average</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${contributionData.consistencyScore}%</span>
                    <span class="stat-label">Consistency</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">${contributionData.totalCount}</span>
                    <span class="stat-label">Total</span>
                </div>
            </div>
        `;
        
        // Suggestions
        const suggestionsHTML = suggestions.map(suggestion => `
            <div class="suggestion-card ${suggestion.priority === 'high' ? 'warning' : suggestion.priority === 'low' ? 'success' : ''}">
                <div class="suggestion-header">
                    <div class="suggestion-icon">
                        <i class="${suggestion.icon}"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">${suggestion.title}</h6>
                        <p class="mb-0 text-muted small">${suggestion.message}</p>
                    </div>
                </div>
            </div>
        `).join('');
        
        // Quick Actions
        const actionsHTML = `
            <div class="quick-action-buttons">
                <button class="btn btn-outline-primary btn-sm" id="quick-contribute-btn">
                    <i class="fas fa-money-bill-wave me-1"></i>Quick Add
                </button>
                <button class="btn btn-outline-success btn-sm" id="schedule-contribution-btn">
                    <i class="fas fa-clock me-1"></i>Schedule
                </button>
            </div>
        `;
        
        container.innerHTML = statsHTML + suggestionsHTML + actionsHTML;
    }

    function setupContributionActions() {
        // Quick contribute button
        document.getElementById('quick-contribute-btn')?.addEventListener('click', function() {
            const amount = prompt('Enter contribution amount (R):', '2500');
            if (amount && !isNaN(amount)) {
                addQuickContribution(parseFloat(amount));
            }
        });
        
        // Schedule contribution button
        document.getElementById('schedule-contribution-btn')?.addEventListener('click', function() {
            scheduleContribution();
        });
    }

    function addQuickContribution(amount) {
        const contributions = getFromStorage('contributions', []);
        const newContribution = {
            amount: amount,
            date: new Date().toISOString().split('T')[0],
            group: 'General',
            type: 'quick'
        };
        
        contributions.push(newContribution);
        saveToStorage('contributions', contributions);
        
        // Update UI
        const savingsElement = document.querySelector('.stats-card.savings h3');
        if (savingsElement) {
            const current = parseInt(savingsElement.textContent.replace('R', '').replace(',', '')) || 0;
            savingsElement.textContent = `R${(current + amount).toLocaleString()}`;
        }
        
        showToast(`âœ… Added R${amount} contribution!`, 'success');
        
        // Refresh suggestions
        setTimeout(() => {
            initializeSmartContributions();
        }, 500);
    }

    function scheduleContribution() {
        const amount = prompt('Schedule contribution amount (R):', '2500');
        const date = prompt('Schedule for date (YYYY-MM-DD):', getNextWeekDate());
        
        if (amount && date) {
            const scheduled = getFromStorage('scheduled_contributions', []);
            scheduled.push({
                amount: parseFloat(amount),
                date: date,
                group: 'Investment Club',
                recurring: false,
                created: new Date().toISOString()
            });
            
            saveToStorage('scheduled_contributions', scheduled);
            showToast(`ðŸ“… Contribution of R${amount} scheduled for ${date}`, 'success');
        }
    }

    function getNextWeekDate() {
        const nextWeek = new Date();
        nextWeek.setDate(nextWeek.getDate() + 7);
        return nextWeek.toISOString().split('T')[0];
    }

    function getPreviousMonth(currentMonth) {
        const [year, month] = currentMonth.split('-').map(Number);
        let prevYear = year;
        let prevMonth = month - 1;
        
        if (prevMonth === 0) {
            prevMonth = 12;
            prevYear = year - 1;
        }
        
        return `${prevYear}-${prevMonth.toString().padStart(2, '0')}`;
    }

    function getRecentActivity(contributions) {
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        
        return contributions.filter(contribution => {
            const contributionDate = new Date(contribution.date);
            return contributionDate >= oneWeekAgo;
        }).length;
    }

    // ===== ENHANCED SECURITY FEATURES =====
    function initializeEnhancedSecurity() {
        console.log('ðŸ›¡ï¸ Initializing Enhanced Security...');
        
        // Initialize all security features
        initializeSessionSecurity();
        initializeDeviceRecognition();
        initializeActivityMonitoring();
        initializeSecurityDashboard();
        setupSecurityEventListeners();
        
        // Log security initialization
        logSecurityActivity('security_system_initialized', 'Security system started');
    }

    function initializeSessionSecurity() {
        let inactivityTimer;
        const sessionTimeout = 30 * 60 * 1000; // 30 minutes in milliseconds
        let warningShown = false;

        const resetTimer = () => {
            clearTimeout(inactivityTimer);
            warningShown = false;
            
            // Reset warning timer
            inactivityTimer = setTimeout(showSessionWarning, sessionTimeout - 60000); // Warn 1 min before
        };

        const showSessionWarning = () => {
            if (warningShown) return;
            warningShown = true;
            
            const warningHTML = `
                <div class="overlay"></div>
                <div class="session-timeout-warning">
                    <div class="warning-icon mb-3">
                        <i class="fas fa-clock fa-2x text-warning"></i>
                    </div>
                    <h5>Session Timeout Warning</h5>
                    <p class="text-muted">Your session will expire in 1 minute due to inactivity.</p>
                    <div class="d-flex gap-2 justify-content-center">
                        <button class="btn btn-primary" id="extend-session-btn">
                            <i class="fas fa-sync me-1"></i>Extend Session
                        </button>
                        <button class="btn btn-outline-secondary" id="logout-now-btn">
                            <i class="fas fa-sign-out-alt me-1"></i>Log Out Now
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', warningHTML);
            
            document.getElementById('extend-session-btn').addEventListener('click', () => {
                resetTimer();
                document.querySelector('.session-timeout-warning').remove();
                document.querySelector('.overlay').remove();
                logSecurityActivity('session_extended', 'User extended session');
            });
            
            document.getElementById('logout-now-btn').addEventListener('click', () => {
                performSoftLogout();
            });
            
            // Auto logout after 1 minute
            setTimeout(() => {
                if (document.querySelector('.session-timeout-warning')) {
                    performSoftLogout();
                }
            }, 60000);
        };

        const performSoftLogout = () => {
            logSecurityActivity('session_timeout', 'Session expired due to inactivity');
            showToast('Session expired due to inactivity', 'warning');
            
            // Clear the warning
            const warning = document.querySelector('.session-timeout-warning');
            const overlay = document.querySelector('.overlay');
            if (warning) warning.remove();
            if (overlay) overlay.remove();
            
            // Reset to login state (soft logout)
            resetToLoginState();
        };

        const resetToLoginState = () => {
            // Clear sensitive data from memory
            clearSensitiveData();
            
            // Show login prompt (in a real app, this would redirect to login)
            showToast('Please log in again to continue', 'info');
            
            // Reset all timers
            clearTimeout(inactivityTimer);
            warningShown = false;
        };

        // Reset timer on user activity
        const activityEvents = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
        activityEvents.forEach(event => {
            document.addEventListener(event, resetTimer, { passive: true });
        });

        // Start the timer
        resetTimer();
        logSecurityActivity('session_security_initialized', 'Session timeout protection active');
    }

    function initializeDeviceRecognition() {
        // Generate a simple device fingerprint (non-invasive)
        const deviceFingerprint = generateDeviceFingerprint();
        const knownDevices = getFromStorage('known_devices', []);
        
        // Check if this device is recognized
        const isKnownDevice = knownDevices.some(device => device.fingerprint === deviceFingerprint);
        
        if (!isKnownDevice) {
            // New device detected
            knownDevices.push({
                fingerprint: deviceFingerprint,
                firstSeen: new Date().toISOString(),
                userAgent: navigator.userAgent,
                lastActive: new Date().toISOString()
            });
            
            saveToStorage('known_devices', knownDevices);
            
            // Show new device alert if enabled
            if (isFeatureEnabled('device-alerts')) {
                showToast('ðŸ”’ New device recognized. Security alert sent.', 'warning');
                logSecurityActivity('new_device_detected', `New device: ${navigator.userAgent.substring(0, 50)}...`);
            }
        } else {
            // Update last active time for known device
            const deviceIndex = knownDevices.findIndex(device => device.fingerprint === deviceFingerprint);
            if (deviceIndex > -1) {
                knownDevices[deviceIndex].lastActive = new Date().toISOString();
                saveToStorage('known_devices', knownDevices);
            }
        }
        
        logSecurityActivity('device_recognition_initialized', 'Device recognition active');
    }

    function generateDeviceFingerprint() {
        // Simple fingerprint based on available properties (no PII)
        const components = [
            navigator.userAgent,
            navigator.language,
            screen.width + 'x' + screen.height,
            navigator.hardwareConcurrency || 'unknown'
        ].join('|');
        
        // Simple hash function
        let hash = 0;
        for (let i = 0; i < components.length; i++) {
            const char = components.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convert to 32bit integer
        }
        return Math.abs(hash).toString(36);
    }

    function initializeActivityMonitoring() {
        // Monitor significant user actions
        const significantEvents = [
            'contribution_added',
            'profile_updated', 
            'password_changed',
            'group_created',
            'settings_modified'
        ];
        
        // Log page views and tab changes
        let lastActiveTab = 'home-tab';
        
        document.addEventListener('click', (e) => {
            const tabLink = e.target.closest('[data-tab]');
            if (tabLink) {
                const newTab = tabLink.getAttribute('data-tab');
                if (newTab !== lastActiveTab) {
                    logSecurityActivity('tab_navigation', `Switched to ${newTab.replace('-tab', '')} tab`);
                    lastActiveTab = newTab;
                }
            }
        });
        
        logSecurityActivity('activity_monitoring_started', 'Activity monitoring initialized');
    }

    function initializeSecurityDashboard() {
        // Calculate security score
        const securityScore = calculateSecurityScore();
        updateSecurityDashboard(securityScore);
        populateActivityLog();
    }

    function calculateSecurityScore() {
        let score = 100;
        const securitySettings = getFromStorage('security_settings', {});
        
        // Deduct points for disabled features
        if (!securitySettings.sessionTimeout) score -= 20;
        if (!securitySettings.deviceAlerts) score -= 15;
        if (!securitySettings.activityLogging) score -= 10;
        
        // Check for recent security events
        const recentActivities = getFromStorage('security_activities', []);
        const recentWarnings = recentActivities.filter(activity => 
            activity.type.includes('warning') || activity.type.includes('suspicious')
        ).length;
        
        score -= recentWarnings * 5;
        
        return Math.max(0, Math.min(100, score));
    }

    function updateSecurityDashboard(score) {
        const scoreElement = document.getElementById('security-score');
        const scoreCircle = document.querySelector('.score-circle');
        
        if (scoreElement) scoreElement.textContent = score;
        
        // Update circle color based on score
        if (scoreCircle) {
            let color;
            if (score >= 80) color = 'var(--success)';
            else if (score >= 60) color = 'var(--warning)';
            else color = 'var(--danger)';
            
            scoreCircle.style.background = `conic-gradient(${color} 0% ${score}%, #e2e8f0 ${score}% 100%)`;
        }
        
        // Update status badges
        updateSecurityStatusIndicators(score);
    }
    function addSignOutButton() {
    const navbarNav = document.querySelector('.navbar-nav');
    if (navbarNav && !document.getElementById('sign-out-btn')) {
        const signOutItem = document.createElement('li');
        signOutItem.className = 'nav-item';
        signOutItem.innerHTML = `
            <a class="nav-link" href="#" id="sign-out-btn">
                <i class="fas fa-sign-out-alt me-1"></i>Sign Out
            </a>
        `;
        navbarNav.appendChild(signOutItem);
        
        document.getElementById('sign-out-btn').addEventListener('click', function(e) {
            e.preventDefault();
            signOut();
        });
    }
}

// Call this in updateUIForAuthenticatedUser
function updateUIForAuthenticatedUser(user) {
    console.log('User authenticated:', user);
    // Hide auth modal if it's open
    const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
    if (authModal) authModal.hide();
    
    // Update UI to show user is logged in
    document.body.classList.add('user-signed-in');
    document.body.classList.remove('user-signed-out');
    
    // Add sign out button
    addSignOutButton();
}

    function updateSecurityStatusIndicators(score) {
        const statusElements = {
            'session-timeout-status': score >= 80 ? 'bg-success' : score >= 60 ? 'bg-warning' : 'bg-danger',
            'device-recognition-status': 'bg-success',
            'activity-monitoring-status': 'bg-success'
        };
        
        Object.entries(statusElements).forEach(([id, badgeClass]) => {
            const element = document.getElementById(id);
            if (element) {
                element.className = `badge ${badgeClass}`;
            }
        });
    }

    function populateActivityLog() {
        const activityLog = document.getElementById('security-activity-log');
        if (!activityLog) return;
        
        const activities = getFromStorage('security_activities', []).slice(-10).reverse();
        
        const activityIcons = {
            'session_extended': 'fas fa-sync',
            'session_timeout': 'fas fa-clock',
            'new_device_detected': 'fas fa-laptop',
            'tab_navigation': 'fas fa-exchange-alt',
            'security_system_initialized': 'fas fa-shield-alt',
            'device_recognition_initialized': 'fas fa-fingerprint',
            'activity_monitoring_started': 'fas fa-chart-line',
            'default': 'fas fa-info-circle'
        };
        
        const activityHTML = activities.map(activity => `
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="${activityIcons[activity.type] || activityIcons.default}"></i>
                </div>
                <div class="activity-details">
                    <div class="fw-semibold">${activity.description}</div>
                    <div class="activity-meta">
                        <i class="fas fa-clock me-1"></i>${new Date(activity.timestamp).toLocaleString()}
                    </div>
                </div>
            </div>
        `).join('');
        
        activityLog.innerHTML = activityHTML || '<div class="text-muted text-center py-3">No recent security activity</div>';
    }

    function setupSecurityEventListeners() {
        // Session timeout toggle
        document.getElementById('session-timeout-switch')?.addEventListener('change', function(e) {
            const enabled = e.target.checked;
            updateSecuritySetting('sessionTimeout', enabled);
            logSecurityActivity('setting_changed', `Session timeout ${enabled ? 'enabled' : 'disabled'}`);
            showToast(`Session timeout ${enabled ? 'enabled' : 'disabled'}`, 'info');
        });
        
        // Device alerts toggle
        document.getElementById('device-alerts-switch')?.addEventListener('change', function(e) {
            const enabled = e.target.checked;
            updateSecuritySetting('deviceAlerts', enabled);
            logSecurityActivity('setting_changed', `Device alerts ${enabled ? 'enabled' : 'disabled'}`);
            showToast(`Device alerts ${enabled ? 'enabled' : 'disabled'}`, 'info');
        });
        
        // Activity logging toggle
        document.getElementById('activity-log-switch')?.addEventListener('change', function(e) {
            const enabled = e.target.checked;
            updateSecuritySetting('activityLogging', enabled);
            logSecurityActivity('setting_changed', `Activity logging ${enabled ? 'enabled' : 'disabled'}`);
            showToast(`Activity logging ${enabled ? 'enabled' : 'disabled'}`, 'info');
        });
    }

    function updateSecuritySetting(setting, value) {
        const securitySettings = getFromStorage('security_settings', {});
        securitySettings[setting] = value;
        saveToStorage('security_settings', securitySettings);
        
        // Recalculate security score
        const newScore = calculateSecurityScore();
        updateSecurityDashboard(newScore);
    }

    function isFeatureEnabled(feature) {
        const securitySettings = getFromStorage('security_settings', {});
        return securitySettings[feature] !== false; // Default to true if not set
    }

    function logSecurityActivity(type, description) {
        if (!isFeatureEnabled('activityLogging')) return;
        
        const activities = getFromStorage('security_activities', []);
        activities.push({
            type,
            description,
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent
        });
        
        // Keep only last 100 activities
        if (activities.length > 100) {
            activities.splice(0, activities.length - 100);
        }
        
        saveToStorage('security_activities', activities);
        
        // Update dashboard if it's visible
        if (document.getElementById('profile-tab')?.classList.contains('active')) {
            populateActivityLog();
            const newScore = calculateSecurityScore();
            updateSecurityDashboard(newScore);
        }
    }

    function clearSensitiveData() {
        // Clear any sensitive data from memory
        // In a real app, this would clear tokens, sensitive user data, etc.
        console.log('ðŸ§¹ Clearing sensitive data from memory...');
        
        // Clear any temporary sensitive variables
        window.sensitiveData = null;
    }

    // Helper function to check if security features should be initialized
    function shouldInitializeSecurity() {
        return document.getElementById('profile-tab') !== null;
    }

    // ===== CSS STYLES =====
    function addPhase4Styles() {
        if (document.getElementById('phase4-styles')) return;
        
        const styles = `
            /* Payment Scheduling Styles */
            .scheduled-payment-item {
                padding: 1rem;
                border: 1px solid #e2e8f0;
                border-radius: 10px;
                margin-bottom: 0.75rem;
                transition: all 0.3s ease;
                background: white;
            }
            .scheduled-payment-item:hover {
                border-color: var(--primary);
                box-shadow: var(--shadow);
                transform: translateY(-1px);
            }
            .payment-actions {
                display: flex;
                gap: 0.5rem;
            }
            
            /* Mobile Quick Actions */
            .modal-bottom .modal-dialog {
                margin: 0;
                position: fixed;
                bottom: 0;
                width: 100%;
                max-width: 100%;
            }
            .modal-bottom .modal-content {
                border-radius: 1rem 1rem 0 0;
                border: none;
                box-shadow: 0 -10px 30px rgba(0,0,0,0.1);
            }
            
            /* Touch-friendly improvements */
            @media (max-width: 768px) {
                .btn, .action-card {
                    min-height: 44px !important;
                    padding: 12px 8px !important;
                }
                
                .scheduled-payment-item {
                    padding: 0.75rem;
                }
                
                .payment-actions .btn {
                    padding: 0.5rem !important;
                    min-height: auto !important;
                }
            }
            
            /* Achievements Grid */
            .achievements-grid {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }
            .achievement-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
                border-radius: 10px;
                background: var(--neutral);
                transition: all 0.3s ease;
            }
            .achievement-item.earned {
                border-left: 4px solid var(--success);
            }
            .achievement-item.locked {
                opacity: 0.6;
                border-left: 4px solid var(--text-light);
            }
            .achievement-item:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow);
            }
            .achievement-icon {
                font-size: 1.5rem;
                width: 40px;
                text-align: center;
            }
            .achievement-info {
                flex: 1;
            }
            .achievement-info strong {
                display: block;
                margin-bottom: 0.25rem;
            }
            .achievement-info small {
                color: var(--text-light);
            }

            /* Smart Contributions */
            .contribution-stats {
                display: flex;
                justify-content: space-around;
                margin-bottom: 1rem;
            }
            .stat-item {
                text-align: center;
            }
            .stat-value {
                display: block;
                font-size: 1.25rem;
                font-weight: bold;
                color: var(--primary);
            }
            .stat-label {
                font-size: 0.875rem;
                color: var(--text-light);
            }
            .suggestion-card {
                padding: 1rem;
                border-radius: 8px;
                margin-bottom: 0.75rem;
                background: var(--neutral);
            }
            .suggestion-card.warning {
                border-left: 4px solid var(--warning);
            }
            .suggestion-card.success {
                border-left: 4px solid var(--success);
            }
            .suggestion-header {
                display: flex;
                align-items: flex-start;
                gap: 1rem;
            }
            .suggestion-icon {
                font-size: 1.25rem;
                color: var(--primary);
            }
            .quick-action-buttons {
                display: flex;
                gap: 0.5rem;
                margin-top: 1rem;
            }

            /* Security Styles */
            .session-timeout-warning {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 2rem;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                text-align: center;
                max-width: 400px;
                width: 90%;
            }
            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 9999;
            }
            .score-circle {
                width: 100px;
                height: 100px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 1rem;
                position: relative;
            }
            .score-circle::before {
                content: '';
                position: absolute;
                width: 80px;
                height: 80px;
                background: white;
                border-radius: 50%;
            }
            .score-circle span {
                position: relative;
                z-index: 1;
                font-size: 1.5rem;
                font-weight: bold;
            }
            .activity-item {
                display: flex;
                align-items: flex-start;
                gap: 1rem;
                padding: 0.75rem;
                border-bottom: 1px solid var(--border);
            }
            .activity-item:last-child {
                border-bottom: none;
            }
            .activity-icon {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                background: var(--neutral);
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--primary);
            }
        `;
        
        const styleSheet = document.createElement('style');
        styleSheet.id = 'phase4-styles';
        styleSheet.textContent = styles;
        document.head.appendChild(styleSheet);
    }

    // ===== OFFLINE DETECTION =====
    window.addEventListener('online', () => {
        showToast('Back online!', 'success');
        document.body.classList.remove('offline');
    });

    window.addEventListener('offline', () => {
        showToast('You\'re offline - some features limited', 'warning');
        document.body.classList.add('offline');
    });

    // ===== INITIAL MOBILE OPTIMIZATIONS =====
    if (window.innerWidth < 768) {
        document.querySelectorAll('.btn, .action-card').forEach(el => {
            el.style.minHeight = '44px';
            el.style.padding = '12px';
        });
    }
    // ===== PROFILE CRUD OPERATIONS =====
async function getCurrentProfile() {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) return null;

  const { data: profile, error } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', user.id)
    .single();

  if (error) {
    console.error('Error fetching profile:', error);
    return null;
  }

  return profile;
}

async function updateProfile(updates) {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) return false;

  const { error } = await supabase
    .from('profiles')
    .update(updates)
    .eq('id', user.id);

  if (error) {
    showToast('Error updating profile: ' + error.message, 'error');
    return false;
  }

  showToast('Profile updated successfully!', 'success');
  return true;
}
// ===== GROUPS CRUD OPERATIONS =====
async function createGroup(groupData) {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) return null;

  const { data, error } = await supabase
    .from('groups')
    .insert([
      {
        ...groupData,
        created_by: user.id,
        created_at: new Date().toISOString()
      }
    ])
    .select()
    .single();

  if (error) {
    showToast('Error creating group: ' + error.message, 'error');
    return null;
  }

  // Auto-add creator as admin member
  await addGroupMember(data.id, user.id, 'admin');
  
  showToast('Group created successfully!', 'success');
  return data;
}

async function getUserGroups() {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) return [];

  const { data, error } = await supabase
    .from('group_members')
    .select(`
      group_id,
      groups (*)
    `)
    .eq('user_id', user.id);

  if (error) {
    console.error('Error fetching groups:', error);
    return [];
  }

  return data.map(item => item.groups);
}

async function addGroupMember(groupId, userId, role = 'member') {
  const { error } = await supabase
    .from('group_members')
    .insert([
      {
        group_id: groupId,
        user_id: userId,
        role: role,
        joined_at: new Date().toISOString()
      }
    ]);

  return !error;
}
// ===== CONTRIBUTIONS CRUD OPERATIONS =====
async function addContribution(contributionData) {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) return null;

  const { data, error } = await supabase
    .from('contributions')
    .insert([
      {
        ...contributionData,
        user_id: user.id,
        created_at: new Date().toISOString()
      }
    ])
    .select()
    .single();

  if (error) {
    showToast('Error adding contribution: ' + error.message, 'error');
    return null;
  }

  showToast('Contribution added successfully!', 'success');
  return data;
}

async function getGroupContributions(groupId) {
  const { data, error } = await supabase
    .from('contributions')
    .select(`
      *,
      profiles:user_id (full_name, email)
    `)
    .eq('group_id', groupId)
    .order('created_at', { ascending: false });

  if (error) {
    console.error('Error fetching contributions:', error);
    return [];
  }

  return data;
}
// ===== CHAT MESSAGES CRUD OPERATIONS =====
async function sendMessage(groupId, message, file = null) {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) return null;

  let fileUrl = null;
  
  // Handle file upload if present
  if (file) {
    const fileName = `${Date.now()}_${file.name}`;
    const { data: fileData, error: fileError } = await supabase.storage
      .from('chat-files')
      .upload(fileName, file);

    if (!fileError) {
      fileUrl = fileData.path;
    }
  }

  const { data, error } = await supabase
    .from('messages')
    .insert([
      {
        group_id: groupId,
        user_id: user.id,
        message: message,
        file_url: fileUrl,
        created_at: new Date().toISOString()
      }
    ])
    .select(`
      *,
      profiles:user_id (full_name, email)
    `)
    .single();

  if (error) {
    showToast('Error sending message: ' + error.message, 'error');
    return null;
  }

  return data;
}

async function getGroupMessages(groupId) {
  const { data, error } = await supabase
    .from('messages')
    .select(`
      *,
      profiles:user_id (full_name, email)
    `)
    .eq('group_id', groupId)
    .order('created_at', { ascending: true });

  if (error) {
    console.error('Error fetching messages:', error);
    return [];
  }

  return data;
}

// Real-time message subscription
function subscribeToGroupMessages(groupId, callback) {
  return supabase
    .channel('group-messages')
    .on(
      'postgres_changes',
      {
        event: 'INSERT',
        schema: 'public',
        table: 'messages',
        filter: `group_id=eq.${groupId}`
      },
      (payload) => {
        callback(payload.new);
      }
    )
    .subscribe();
}
async function testCRUDOperations() {
  console.log('ðŸ§ª Testing Supabase CRUD operations...');
  
  // Test: Create a test group
  const testGroup = await createGroup({
    name: 'Test Group',
    description: 'This is a test group',
    currency: 'ZAR'
  });
  
  if (testGroup) {
    console.log('âœ… Group creation: PASSED');
    
    // Test: Add contribution
    const testContribution = await addContribution({
      group_id: testGroup.id,
      amount: 1000,
      description: 'Test contribution'
    });
    
    if (testContribution) {
      console.log('âœ… Contribution creation: PASSED');
    }
    
    // Test: Send message
    const testMessage = await sendMessage(testGroup.id, 'Hello from CRUD test!');
    if (testMessage) {
      console.log('âœ… Message creation: PASSED');
    }
  }
  
  console.log('ðŸŽ‰ CRUD tests completed!');
}
// ===== MISSING AUTH HELPER FUNCTIONS =====
function updateUIForAuthenticatedUser(user) {
    console.log('User authenticated:', user);
    // Hide auth modal if it's open
    const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
    if (authModal) authModal.hide();
    
    // Update UI to show user is logged in
    document.body.classList.add('user-signed-in');
    document.body.classList.remove('user-signed-out');
}

function showLoginModal() {
    const authModal = new bootstrap.Modal(document.getElementById('authModal'));
    authModal.show();
}

function showLoginForm() {
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('signupForm').style.display = 'none';
    document.querySelector('.modal-body > .d-grid').style.display = 'none';
}

function showSignupForm() {
    document.getElementById('signupForm').style.display = 'block';
    document.getElementById('loginForm').style.display = 'none';
    document.querySelector('.modal-body > .d-grid').style.display = 'none';
}

function showAuthOptions() {
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('signupForm').style.display = 'none';
    document.querySelector('.modal-body > .d-grid').style.display = 'grid';
}

async function handleLogin(event) {
    event.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    const user = await signIn(email, password);
    if (user) {
        const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
        if (authModal) authModal.hide();
        window.location.reload();
    }
}

async function handleSignup(event) {
    event.preventDefault();
    const name = document.getElementById('signupName').value;
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    
    const user = await signUp(email, password, name);
    if (user) {
        const authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
        if (authModal) authModal.hide();
        // Don't reload - let email verification handle it
    }
}
async function renderGroupsList(groups) {
    const container = document.querySelector('.online-members');
    if (!container) return;
    
    // Clear existing content
    container.innerHTML = '<h5 class="mb-3">Your Groups</h5>';
    
    if (groups.length === 0) {
        container.innerHTML += '<p class="text-muted">No groups yet. Create your first group!</p>';
        return;
    }
    
    groups.forEach(group => {
        const groupDiv = document.createElement('div');
        groupDiv.className = 'online-member';
        groupDiv.innerHTML = `
            <div class="message-avatar bg-primary">${group.name.charAt(0)}</div>
            <div class="flex-grow-1">
                <div class="fw-semibold">${group.name}</div>
                <small class="text-muted">${group.description || 'Stokvel Group'} â€¢ ${group.member_count || 1} members</small>
            </div>
            <div class="online-indicator"></div>
        `;
        container.appendChild(groupDiv);
    });
}
// ===== TEST FUNCTION =====
async function testCRUDOperations() {
    console.log('ðŸ§ª Testing Supabase CRUD operations...');
    
    const testGroup = await createGroup({
        name: 'Test Group',
        description: 'This is a test group',
        currency: 'ZAR'
    });
    
    if (testGroup) {
        console.log('âœ… Group creation: PASSED');
        
        const testContribution = await addContribution({
            group_id: testGroup.id,
            amount: 1000,
            description: 'Test contribution'
        });
        
        if (testContribution) console.log('âœ… Contribution creation: PASSED');
        
        const testMessage = await sendMessage(testGroup.id, 'Hello from CRUD test!');
        if (testMessage) console.log('âœ… Message creation: PASSED');
    }
    
    console.log('ðŸŽ‰ CRUD tests completed!');
}
</script>
<!-- Encryption Settings Modal -->
<div class="modal fade" id="encryptionSettingsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-lock me-2"></i>Message Encryption Settings
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Security Level Indicator -->
                <div class="security-level-indicator">
                    <div>
                        <strong>Encryption Strength</strong>
                        <div class="text-muted small">AES-256-GCM + RSA-2048</div>
                    </div>
                    <div class="security-level-bar">
                        <div class="security-level-fill strong" id="security-level-fill"></div>
                    </div>
                    <span class="badge bg-success" id="security-level-text">Strong</span>
                </div>

                <!-- Current Encryption Status -->
                <div class="encryption-settings">
                    <h6 class="mb-3">Current Configuration</h6>
                    
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Encryption Status</label>
                        <div class="encryption-status" id="modal-encryption-status">
                            <i class="fas fa-lock"></i>
                            <span>End-to-End Encrypted</span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold">Your Encryption Key</label>
                        <div class="encryption-key-display" id="user-key-display">
                            Loading...
                        </div>
                        <small class="text-muted">This key is used to encrypt your messages</small>
                    </div>

                    <div class="key-management">
                        <div>
                            <label class="form-label fw-semibold">Group Encryption Key</label>
                            <div class="text-muted small">Shared with all group members</div>
                        </div>
                        <button class="btn btn-outline-primary btn-sm" id="rotate-keys-btn">
                            <i class="fas fa-sync me-1"></i>Rotate Keys
                        </button>
                    </div>
                </div>

                <!-- Encryption Warning -->
                <div class="encryption-warning">
                    <div class="d-flex align-items-start gap-2">
                        <i class="fas fa-exclamation-triangle text-warning mt-1"></i>
                        <div>
                            <strong>Important Security Notice</strong>
                            <p class="mb-0 small">Your messages are encrypted end-to-end. If you lose your encryption keys, you will not be able to read previous messages. Export and backup your keys regularly.</p>
                        </div>
                    </div>
                </div>

                <!-- Export Keys Section -->
                <div class="export-keys-section">
                    <h6 class="mb-3">Key Management</h6>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary" id="backup-keys-btn">
                            <i class="fas fa-download me-1"></i>Backup Keys
                        </button>
                        <button class="btn btn-outline-warning" id="import-keys-btn">
                            <i class="fas fa-upload me-1"></i>Import Keys
                        </button>
                        <button class="btn btn-outline-danger" id="reset-keys-btn">
                            <i class="fas fa-trash me-1"></i>Reset Keys
                        </button>
                    </div>
                </div>

                <!-- Help Section -->
                <div class="encryption-help">
                    <h6 class="mb-3">How It Works</h6>
                    <div class="help-item">
                        <i class="fas fa-shield-alt help-icon"></i>
                        <div>
                            <strong>End-to-End Encryption</strong>
                            <p class="mb-0 small">Only you and the recipients can read messages. Not even Stokvel Pro can decrypt your conversations.</p>
                        </div>
                    </div>
                    <div class="help-item">
                        <i class="fas fa-key help-icon"></i>
                        <div>
                            <strong>Key Management</strong>
                            <p class="mb-0 small">Your encryption keys are stored locally in your browser. Back them up to avoid losing access.</p>
                        </div>
                    </div>
                    <div class="help-item">
                        <i class="fas fa-sync help-icon"></i>
                        <div>
                            <strong>Key Rotation</strong>
                            <p class="mb-0 small">Regularly rotate keys for enhanced security. Old messages remain accessible with previous keys.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="save-encryption-settings">
                    <i class="fas fa-save me-1"></i>Save Settings
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Auth Modal -->
<div class="modal fade" id="authModal" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Welcome to Stokvel Pro</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="d-grid gap-2">
          <button class="btn btn-primary" onclick="showLoginForm()">
            <i class="fas fa-sign-in-alt me-2"></i>Sign In
          </button>
          <button class="btn btn-outline-primary" onclick="showSignupForm()">
            <i class="fas fa-user-plus me-2"></i>Create Account
          </button>
        </div>
        
        <!-- Login Form -->
        <div id="loginForm" style="display: none;">
          <form onsubmit="handleLogin(event)">
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="loginEmail" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" class="form-control" id="loginPassword" required>
            </div>
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary">Sign In</button>
              <button type="button" class="btn btn-link" onclick="showAuthOptions()">Back</button>
            </div>
          </form>
        </div>
        
        <!-- Signup Form -->
        <div id="signupForm" style="display: none;">
          <form onsubmit="handleSignup(event)">
            <div class="mb-3">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" id="signupName" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="signupEmail" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" class="form-control" id="signupPassword" required minlength="6">
            </div>
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary">Create Account</button>
              <button type="button" class="btn btn-link" onclick="showAuthOptions()">Back</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Auth Modal -->
<div class="modal fade" id="authModal" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Welcome to Stokvel Pro</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="d-grid gap-2">
          <button class="btn btn-primary" onclick="showLoginForm()">
            <i class="fas fa-sign-in-alt me-2"></i>Sign In
          </button>
          <button class="btn btn-outline-primary" onclick="showSignupForm()">
            <i class="fas fa-user-plus me-2"></i>Create Account
          </button>
        </div>
        
        <!-- Login Form -->
        <div id="loginForm" style="display: none;">
          <form onsubmit="handleLogin(event)">
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="loginEmail" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" class="form-control" id="loginPassword" required>
            </div>
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary">Sign In</button>
              <button type="button" class="btn btn-link" onclick="showAuthOptions()">Back</button>
            </div>
          </form>
        </div>
        
        <!-- Signup Form -->
        <div id="signupForm" style="display: none;">
          <form onsubmit="handleSignup(event)">
            <div class="mb-3">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" id="signupName" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="signupEmail" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" class="form-control" id="signupPassword" required minlength="6">
            </div>
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary">Create Account</button>
              <button type="button" class="btn btn-link" onclick="showAuthOptions()">Back</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Auth Modal - ADD THIS TO YOUR HTML -->
<div class="modal fade" id="authModal" tabindex="-1">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Welcome to Stokvel Pro</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="d-grid gap-2">
          <button class="btn btn-primary" onclick="showLoginForm()">
            <i class="fas fa-sign-in-alt me-2"></i>Sign In
          </button>
          <button class="btn btn-outline-primary" onclick="showSignupForm()">
            <i class="fas fa-user-plus me-2"></i>Create Account
          </button>
        </div>
        
        <!-- Login Form -->
        <div id="loginForm" style="display: none;">
          <form onsubmit="handleLogin(event)">
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="loginEmail" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" class="form-control" id="loginPassword" required>
            </div>
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary">Sign In</button>
              <button type="button" class="btn btn-link" onclick="showAuthOptions()">Back</button>
            </div>
          </form>
        </div>
        
        <!-- Signup Form -->
        <div id="signupForm" style="display: none;">
          <form onsubmit="handleSignup(event)">
            <div class="mb-3">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" id="signupName" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="signupEmail" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" class="form-control" id="signupPassword" required minlength="6">
            </div>
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary">Create Account</button>
              <button type="button" class="btn btn-link" onclick="showAuthOptions()">Back</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>